<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Memoria - N√∫meros Binarios</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, rgba(0, 160, 169, 0.75) 0%, rgba(0, 138, 138, 0.75) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Arial', sans-serif;
            padding: 20px;
            box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.1);
        }

        .game-container {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15), 0 10px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 800px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .title {
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }

        .phase-title {
            color: #666;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .section-title {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
            font-weight: bold;
        }

        .number-display {
            font-size: 4.5rem;
            font-weight: bold;
            color: #333;
            margin: 30px 0;
            padding: 20px;
            background: linear-gradient(145deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            border: 3px solid #e9ecef;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            font-family: 'Courier New', monospace;
        }
        
        /* Estilo especial para fase de memorizaci√≥n sin bordes */
        .number-display.memorization {
            border: none;
            background: transparent;
        }
        
        .number-display.memorization div > div {
            border: none !important;
            background: transparent !important;
        }

        .input-field {
            font-size: 2rem;
            padding: 15px;
            border: 3px solid #ddd;
            border-radius: 10px;
            text-align: center;
            width: 100%;
            max-width: 300px;
            margin: 20px 0;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
        }

        .small-input {
            font-size: 1rem;
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            text-align: center;
            width: 80px;
            margin: 0 10px;
        }

        .small-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .button {
            background: linear-gradient(135deg, rgba(0, 160, 169, 0.75) 0%, rgba(0, 138, 138, 0.75) 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.2rem;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            font-weight: 600;
        }

        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, rgba(0, 138, 138, 0.75) 0%, rgba(0, 102, 102, 0.75) 100%);
        }

        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .digits-input-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2px;
            margin: 20px auto;
            max-width: 800px;
            padding: 5px;
            justify-content: center;
        }
        
        /* Estilo espec√≠fico para contenedores del men√∫ principal */
        .section .digits-input-container {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            gap: 15px !important;
            margin: 20px auto !important;
            max-width: 400px !important;
            padding: 15px !important;
            grid-template-columns: unset !important;
        }
        
        .digits-input-container.triple-mode {
            grid-template-columns: repeat(6, 1fr);
            max-width: 1000px;
            gap: 1px;
        }



        .number-pair {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            font-family: 'Courier New', monospace;
            min-width: 100px;
        }

        .page-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }

        .page-info {
            font-size: 1.1rem;
            color: #666;
            font-weight: bold;
        }

        .digit-input.correct {
            border-color: #28a745;
            background: linear-gradient(145deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            box-shadow: 0 2px 4px rgba(40, 167, 69, 0.3);
        }

        .digit-input.incorrect {
            border-color: #dc3545;
            background: linear-gradient(145deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
        }

        .digits-input {
            width: 80px;
            height: 50px;
            border: 3px solid #ddd;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            background: #f8f9fa;
            color: #333;
            font-family: 'Courier New', monospace;
            transition: all 0.3s;
        }

        .digits-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            transform: scale(1.05);
        }

        .digits-input:invalid {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .result-message {
            font-size: 1.5rem;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
        }

        .correct-result {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .incorrect-result {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .timer {
            font-size: 1.2rem;
            color: #666;
            margin: 10px 0;
        }

        .progress-indicator {
            font-size: 1.1rem;
            color: #666;
            margin: 15px 0;
        }

        .hidden {
            display: none;
        }

        .timer-config {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .timer-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .timer-option label {
            font-size: 1.1rem;
            color: #333;
        }

        .timer-select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: #f8f9fa;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
        }

        .timer-select:hover {
            background: #e9ecef;
        }
        
        .timer-select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
        }

        .summary {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #bbdefb;
        }

        .summary h3 {
            color: #1976d2;
            margin-bottom: 15px;
        }

        .summary p {
            margin: 8px 0;
            color: #333;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .mode-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .mode-option label {
            font-size: 1.1rem;
            color: #333;
        }

        .mode-radio {
            margin: 0 5px;
        }

        /* Estilos para la din√°mica de recall */
        .continuous-input-container {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .continuous-input {
            width: 100%;
            max-width: 400px;
            font-size: 1.5rem;
            padding: 15px;
            border: 3px solid #ddd;
            border-radius: 10px;
            text-align: center;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }

        .continuous-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-hint {
            font-size: 0.9rem;
            color: #666;
            margin: 5px 0;
        }

        .digits-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2px;
            margin: 30px 0;
            padding: 5px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }
        
        .digits-grid.triple-mode {
            grid-template-columns: repeat(6, 1fr);
            gap: 1px;
        }

        .digit-input {
            width: 40px;
            height: 40px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            color: #333;
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .digit-input:focus {
            outline: none;
            border-color: #667eea;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
            background: linear-gradient(145deg, #ffffff 0%, #f0f4ff 100%);
        }

        .digit-input.correct {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

                 .digit-input.incorrect {
             background: #f8d7da;
             border-color: #dc3545;
             color: #721c24;
         }
         
         /* Estilos para sistema de rondas */
         .progress-bar {
             width: 100%;
             height: 20px;
             background: #e9ecef;
             border-radius: 10px;
             margin: 15px 0;
             overflow: hidden;
         }
         
         .progress-fill {
             height: 100%;
             background: linear-gradient(135deg, rgba(0, 160, 169, 0.75) 0%, rgba(0, 138, 138, 0.75) 100%);
             transition: width 0.3s ease;
             width: 0%;
         }
         
         .final-score {
             background: #e3f2fd;
             border-radius: 15px;
             padding: 30px;
             margin: 20px 0;
             border: 2px solid #bbdefb;
             text-align: center;
         }
         
         .score-display {
             font-size: 3rem;
             font-weight: bold;
             margin: 20px 0;
         }
         
         .score-number {
             color: #1976d2;
         }
         
         .score-label {
             color: #666;
             font-size: 1.5rem;
         }
         
         .score-percentage {
             font-size: 2rem;
             color: #28a745;
             font-weight: bold;
         }
         
         .round-breakdown {
             background: #f8f9fa;
             border-radius: 15px;
             padding: 20px;
             margin: 20px 0;
             border: 2px solid #e9ecef;
         }
         
         .rounds-grid {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
             gap: 10px;
             margin: 15px 0;
         }
         
         .round-item {
             padding: 10px;
             border-radius: 8px;
             text-align: center;
             font-weight: bold;
             font-size: 0.9rem;
         }
         
         .round-item.correct {
             background: #d4edda;
             color: #155724;
             border: 2px solid #c3e6cb;
         }
         
         .round-item.incorrect {
             background: #f8d7da;
             color: #721c24;
             border: 2px solid #f5c6cb;
         }
         
         .performance-summary {
             background: #fff3cd;
             border-radius: 15px;
             padding: 20px;
             margin: 20px 0;
             border: 2px solid #ffeaa7;
         }
         
         .performance-summary h4 {
             color: #856404;
             margin-bottom: 15px;
         }
         
         .performance-summary p {
             margin: 8px 0;
             color: #333;
         }

         /* Estilos para progresi√≥n de resultados */
         .rounds-progress-grid {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
             gap: 8px;
             margin: 15px 0;
             max-width: 600px;
             margin-left: auto;
             margin-right: auto;
         }
         
         .progress-round-item {
             width: 40px;
             height: 40px;
             border-radius: 50%;
             display: flex;
             align-items: center;
             justify-content: center;
             font-weight: bold;
             font-size: 0.9rem;
             border: 2px solid transparent;
             transition: all 0.3s;
         }
         
         .progress-round-item.correct {
             background: #d4edda;
             color: #155724;
             border-color: #c3e6cb;
         }
         
         .progress-round-item.incorrect {
             background: #f8d7da;
             color: #721c24;
             border-color: #f5c6cb;
         }
         
         .progress-round-item.pending {
             background: #e9ecef;
             color: #6c757d;
             border-color: #dee2e6;
         }
         
         .progress-stats {
             background: #f8f9fa;
             border-radius: 10px;
             padding: 15px;
             margin: 15px 0;
             border: 2px solid #e9ecef;
         }
         
         .progress-stats p {
             margin: 8px 0;
             color: #333;
             font-size: 1.1rem;
         }

         /* Estilos para gr√°ficas circulares */
         .chart-container {
             display: flex;
             justify-content: center;
             align-items: center;
             gap: 30px;
             margin: 20px 0;
             flex-wrap: wrap;
         }
         
         .pie-chart {
             position: relative;
             width: 120px;
             height: 120px;
             border-radius: 50%;
             background: conic-gradient(#e9ecef 0deg 360deg);
             display: flex;
             align-items: center;
             justify-content: center;
             box-shadow: 0 4px 8px rgba(0,0,0,0.1);
         }
         
         .pie-chart::before {
             content: '';
             position: absolute;
             width: 80px;
             height: 80px;
             background: white;
             border-radius: 50%;
             z-index: 1;
         }
         
         .pie-chart-text {
             position: relative;
             z-index: 2;
             font-size: 1.5rem;
             font-weight: bold;
             color: #333;
         }
         
         .chart-label {
             text-align: center;
             font-weight: bold;
             color: #666;
             margin-top: 10px;
             font-size: 0.9rem;
         }
         
         .stats-grid {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
             gap: 20px;
             margin: 20px 0;
         }
         
         .stat-card {
             background: white;
             border-radius: 15px;
             padding: 20px;
             text-align: center;
             box-shadow: 0 4px 8px rgba(0,0,0,0.1);
             border: 2px solid #e9ecef;
         }
         
         .stat-number {
             font-size: 2.5rem;
             font-weight: bold;
             margin: 10px 0;
         }
         
         .stat-number.correct {
             color: #28a745;
         }
         
         .stat-number.incorrect {
             color: #dc3545;
         }
         
         .stat-number.neutral {
             color: #007bff;
         }
         
         .stat-label {
             color: #666;
             font-size: 1rem;
             margin-bottom: 5px;
         }

         /* Estilos para comparaci√≥n visual */
         .visual-comparison {
             background: white;
             border-radius: 15px;
             padding: 20px;
             margin: 20px 0;
             border: 2px solid #e9ecef;
         }

         .comparison-row {
             display: flex;
             justify-content: center;
             align-items: center;
             gap: 10px;
             margin: 10px 0;
             flex-wrap: wrap;
         }

         .comparison-number {
             display: flex;
             gap: 2px;
             font-family: 'Courier New', monospace;
             font-size: 1.5rem;
             font-weight: bold;
         }

         .comparison-digit {
             width: 30px;
             height: 40px;
             display: flex;
             align-items: center;
             justify-content: center;
             border-radius: 5px;
             border: 2px solid transparent;
         }

         .comparison-digit.correct {
             background: #d4edda;
             color: #155724;
             border-color: #c3e6cb;
         }

         .comparison-digit.incorrect {
             background: #f8d7da;
             color: #721c24;
             border-color: #f5c6cb;
         }

                 .comparison-label {
            font-size: 1rem;
            color: #666;
            font-weight: bold;
            margin: 0 15px;
            min-width: 100px;
            text-align: right;
        }
        
        .fullscreen-button {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%) !important;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 1.2rem;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 40px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .fullscreen-button:hover {
            transform: translateY(-2px);
            background: linear-gradient(135deg, #495057 0%, #6c757d 100%) !important;
        }
        
        .fullscreen-button.fullscreen {
            background: linear-gradient(135deg, rgba(0, 160, 169, 0.75) 0%, rgba(0, 138, 138, 0.75) 100%) !important;
        }
        
        .fullscreen-button.fullscreen:hover {
            background: linear-gradient(135deg, rgba(0, 138, 138, 0.75) 0%, rgba(0, 102, 102, 0.75) 100%) !important;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
                margin: 5px;
                border-radius: 15px;
            }
            
            .timer-config, .mode-selector {
                flex-direction: column;
                align-items: center;
            }
            
            .number-display {
                font-size: 3rem;
                padding: 15px;
                margin: 15px 0;
            }
            
            /* Fase de memorizaci√≥n - m√≥vil */
            .number-display div {
                gap: 20px !important;
                font-size: 3.5rem !important;
            }
            
            .number-display div > div {
                padding: 15px !important;
                min-width: 120px !important;
            }

            .digits-grid {
                gap: 1px;
                padding: 4px;
            }
            
            .digits-input-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 2px;
                padding: 4px;
                max-width: 600px;
            }
            
            .digits-input-container.triple-mode {
                grid-template-columns: repeat(3, 1fr);
                max-width: 700px;
            }

            .digit-input {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
            
            /* Fase de escritura - m√≥vil */
            .number-pair {
                padding: 8px !important;
                min-width: 70px !important;
            }
            
            .number-pair div {
                gap: 2px !important;
            }
            
            .number-pair input {
                width: 30px !important;
                height: 30px !important;
                font-size: 1.1rem !important;
            }
            
            .fullscreen-button {
                font-size: 1rem;
                padding: 6px 10px;
                top: 10px;
                right: 10px;
                min-width: 35px;
                min-height: 35px;
            }
            
            .title {
                font-size: 1.8rem;
            }
            
            .phase-title {
                font-size: 1.4rem;
            }
            
            /* Fase de resultados - m√≥vil */
            .visual-comparison {
                font-size: 0.9rem !important;
            }
            
            .visual-comparison .digit {
                width: 22px !important;
                height: 22px !important;
                font-size: 0.8rem !important;
                margin: 1px !important;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 10px !important;
            }
            
            .stat-card {
                padding: 15px !important;
            }
            
            .stat-number {
                font-size: 1.8rem !important;
            }
            
            .rounds-percentage-list {
                font-size: 0.9rem !important;
            }
            
            /* Controles especiales - m√≥vil */
            #special-controls-info {
                font-size: 0.8rem !important;
                padding: 10px !important;
            }
            
            #special-controls-info span {
                font-size: 0.7rem !important;
            }
            
            /* Configuraci√≥n de controles especiales - m√≥vil */
            .section div[style*="grid-template-columns"] {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 8px !important;
            }
            
            .section div[style*="grid-template-columns"] > div {
                min-width: auto !important;
                padding: 8px !important;
            }
            
            /* Contenedores del men√∫ principal - m√≥vil */
            .section .digits-input-container {
                max-width: 250px !important;
                gap: 8px !important;
                padding: 8px !important;
            }
        }
        
        @media (max-width: 480px) {
            .game-container {
                padding: 10px;
                margin: 2px;
            }
            
            .number-display {
                font-size: 2.5rem;
                padding: 10px;
            }
            
            /* Fase de memorizaci√≥n - pantallas muy peque√±as */
            .number-display div {
                gap: 15px !important;
                font-size: 3rem !important;
            }
            
            .number-display div > div {
                padding: 10px !important;
                min-width: 90px !important;
            }
            
            .digit-input {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
            
            /* Fase de escritura - pantallas muy peque√±as */
            .number-pair {
                padding: 6px !important;
                min-width: 60px !important;
            }
            
            .number-pair div {
                gap: 1px !important;
            }
            
            .number-pair input {
                width: 28px !important;
                height: 28px !important;
                font-size: 1rem !important;
            }
            
            .digits-grid {
                gap: 1px;
                padding: 3px;
            }
            
            .digits-input-container {
                grid-template-columns: repeat(1, 1fr);
                gap: 1px;
                padding: 3px;
                max-width: 350px;
            }
            
            .digits-input-container.triple-mode {
                grid-template-columns: repeat(2, 1fr);
                max-width: 400px;
            }
            
            .button {
                padding: 10px 16px;
                font-size: 0.9rem;
            }
            
            /* Fase de resultados - pantallas muy peque√±as */
            .visual-comparison {
                font-size: 0.8rem !important;
            }
            
            .visual-comparison .digit {
                width: 18px !important;
                height: 18px !important;
                font-size: 0.7rem !important;
                margin: 1px !important;
            }
            
            .stats-grid {
                grid-template-columns: 1fr !important;
                gap: 8px !important;
            }
            
            .stat-card {
                padding: 12px !important;
            }
            
            .stat-number {
                font-size: 1.4rem !important;
            }
            
            .rounds-percentage-list {
                font-size: 0.8rem !important;
            }
            
            /* Controles especiales - pantallas muy peque√±as */
            #special-controls-info {
                font-size: 0.7rem !important;
                padding: 8px !important;
            }
            
            #special-controls-info span {
                font-size: 0.6rem !important;
            }
            
            /* Configuraci√≥n de controles especiales - pantallas muy peque√±as */
            .section div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
                gap: 6px !important;
            }
            
            .section div[style*="grid-template-columns"] > div {
                min-width: auto !important;
                padding: 6px !important;
            }
            
            /* Configuraci√≥n de visualizaci√≥n - pantallas muy peque√±as */
            .section div[style*="flex-direction: column"] {
                flex-direction: column !important;
                gap: 8px !important;
            }
            
            .section div[style*="flex-direction: column"] > div {
                min-width: auto !important;
                padding: 8px !important;
            }
            
            /* Contenedores del men√∫ principal - pantallas muy peque√±as */
            .section .digits-input-container {
                max-width: 200px !important;
                gap: 6px !important;
                padding: 6px !important;
            }
        }

        /* Estilos para la fase de preparaci√≥n */
        .prep-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }
        .prep-circle {
            width: 260px;
            height: 260px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.08), rgba(255,255,255,0) 60%), #000000;
            box-shadow: 0 20px 40px rgba(0,0,0,0.25), inset 0 0 0 10px rgba(255,255,255,0.12);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border: 6px solid rgba(255,255,255,0.18);
            animation: prepPulse 1.6s ease-in-out infinite;
        }
        .prep-circle::after {
            content: '';
            position: absolute;
            inset: -14px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, rgba(255,255,255,0.35), rgba(255,255,255,0));
            filter: blur(8px);
            opacity: 0.5;
        }
        .prep-count {
            font-size: 6rem;
            font-weight: 900;
            color: #ffffff;
            text-shadow: 0 4px 16px rgba(0,0,0,0.35);
            line-height: 1;
        }
        .prep-subtitle {
            color: #000000;
            font-size: 1.2rem;
            opacity: 0.95;
        }
        @keyframes prepPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 20px 40px rgba(0,0,0,0.25), inset 0 0 0 10px rgba(255,255,255,0.12); }
            50% { transform: scale(1.03); box-shadow: 0 24px 48px rgba(0,0,0,0.3), inset 0 0 0 12px rgba(255,255,255,0.15); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <button class="fullscreen-button" id="fullscreen-btn" onclick="toggleFullscreen()" title="Pantalla Completa">‚õ∂</button>
        <h1 class="title">N√∫meros Binarios</h1>
        
        <!-- Fase de Configuraci√≥n -->
        <div id="setup-phase">
            <h2 class="phase-title">Configuraci√≥n del Juego</h2>
            
            <!-- N√∫meros a Memorizar -->
            <div class="section">
                <h3 class="section-title">1. N√∫meros a Memorizar</h3>
                <p>Escribe cu√°ntos n√∫meros binarios quieres memorizar (de 3 d√≠gitos cada uno):</p>
                <div class="digits-input-container">
                    <input type="number" id="digits-input" class="digits-input" min="1" max="999999" value="" placeholder="5">
                    <span style="font-size: 1.1rem; color: #333;">n√∫meros</span>
                </div>
                <p id="selected-info">Memorizar√°s 5 n√∫meros binarios de 3 d√≠gitos (2 n√∫meros por p√°gina)</p>
            </div>

            <!-- Configuraci√≥n de Visualizaci√≥n -->
            <div class="section">
                <h3 class="section-title">2. Visualizaci√≥n</h3>
                
                <!-- Modo Especial: Matriz 3x6 -->
                <div style="margin-bottom: 30px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; border: 3px solid #5a67d8;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <input type="checkbox" id="special-matrix-mode" style="width: 20px; height: 20px; cursor: pointer;">
                        <label for="special-matrix-mode" style="font-weight: bold; color: white; font-size: 1.2rem; cursor: pointer; margin: 0;">
                            ‚≠ê Modo Especial: Matriz 3√ó6
                        </label>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.95); padding: 15px; border-radius: 10px; margin-top: 10px;">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                            <p style="color: #333; font-size: 0.95rem; margin: 0 0 10px 0; text-align: center;">
                                <strong>Formato:</strong> 3 filas √ó 6 d√≠gitos (18 d√≠gitos binarios por grupo)
                            </p>
                            <div style="font-family: 'Courier New', monospace; font-size: 1.3rem; font-weight: bold; color: #333; text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 2px solid #667eea; line-height: 1.8;">
                                000000<br>111000<br>101010
                            </div>
                            <p style="color: #666; font-size: 0.85rem; margin: 10px 0 0 0; text-align: center;">
                                ‚ÑπÔ∏è Al activar este modo, se deshabilitar√°n las opciones de direcci√≥n y grupos por p√°gina
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Selector de Direcci√≥n -->
                <div id="direction-selector" style="margin-bottom: 30px;">
                    <p>Elige la direcci√≥n de disposici√≥n de los n√∫meros:</p>
                    <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px; margin: 10px 0; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; background: white; min-width: 200px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="radio" id="horizontal-direction" name="direction-mode" value="horizontal" checked>
                                <label for="horizontal-direction" style="font-weight: bold; color: #333;">Horizontal</label>
                                <span style="font-size: 0.9rem; color: #666;">(Actual)</span>
                            </div>
                            <div style="font-family: 'Courier New', monospace; font-size: 1.2rem; font-weight: bold; color: #333; text-align: center; padding: 10px; background: #f8f9fa; border-radius: 5px; border: 1px solid #e9ecef;">
                                111<br>000
                            </div>
                        </div>
                        
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px; margin: 10px 0; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; background: white; min-width: 200px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="radio" id="vertical-direction" name="direction-mode" value="vertical">
                                <label for="vertical-direction" style="font-weight: bold; color: #333;">Vertical</label>
                                <span style="font-size: 0.9rem; color: #666;">(Nuevo)</span>
                            </div>
                            <div style="font-family: 'Courier New', monospace; font-size: 1.2rem; font-weight: bold; color: #333; text-align: center; padding: 10px; background: #f8f9fa; border-radius: 5px; border: 1px solid #e9ecef;">
                                111<br>000<br>010<br>101
                            </div>
                        </div>
                    </div>
                    <p id="direction-info" style="font-size: 0.9rem; color: #666; margin-top: 10px;">Disposici√≥n horizontal: grupos separados por p√°ginas.</p>
                </div>
                
                <!-- Selector de Grupos por P√°gina -->
                <div id="groups-selector">
                <p>Elige cu√°ntos grupos de n√∫meros binarios quieres ver por p√°gina:</p>
                <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 10px; margin: 10px 0; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; background: white; min-width: 200px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="radio" id="single-group-mode" name="display-mode" value="single" checked>
                            <label for="single-group-mode" style="font-weight: bold; color: #333;">1 grupo</label>
                            <span style="font-size: 0.9rem; color: #666;">(M√°s f√°cil)</span>
                        </div>
                        <div style="font-family: 'Courier New', monospace; font-size: 1.2rem; font-weight: bold; color: #333; text-align: center; padding: 10px; background: #f8f9fa; border-radius: 5px; border: 1px solid #e9ecef;">
                            111<br>000
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 10px; margin: 10px 0; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; background: white; min-width: 200px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="radio" id="pairs-mode" name="display-mode" value="pairs">
                            <label for="pairs-mode" style="font-weight: bold; color: #333;">2 grupos</label>
                            <span style="font-size: 0.9rem; color: #666;">(Recomendado)</span>
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 10px; margin: 10px 0; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; background: white; min-width: 200px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="radio" id="triple-mode" name="display-mode" value="triple">
                            <label for="triple-mode" style="font-weight: bold; color: #333;">3 grupos</label>
                            <span style="font-size: 0.9rem; color: #666;">(M√°s dif√≠cil)</span>
                        </div>
                    </div>
                </div>
                <p id="display-info" style="font-size: 0.9rem; color: #666; margin-top: 10px;">Ver√°s los n√∫meros binarios en grupos de 1 por p√°gina con disposici√≥n horizontal.</p>
                </div>
            </div>

            <!-- Tiempo de Memorizaci√≥n -->
            <div class="section">
                <h3 class="section-title">3. Tiempo de Memorizaci√≥n</h3>
                
                <div class="mode-selector">
                    <div class="mode-option">
                        <input type="radio" id="memorization-mode" name="time-mode" value="memorization" class="mode-radio" checked>
                        <label for="memorization-mode">Tiempo para memorizaci√≥n (segundos):</label>
                        <input type="number" id="memorization-timer" class="timer-select" min="1" max="999999" step="0.1" value="" placeholder="15">
                        <div id="memorization-time-conversion" style="font-size: 0.9rem; color: #666; margin-top: 5px;"></div>
                    </div>
                    
                    <div class="mode-option">
                        <input type="radio" id="auto-advance-mode" name="time-mode" value="auto-advance" class="mode-radio">
                        <label for="auto-advance-mode">Autoavance (segundos):</label>
                        <input type="number" id="auto-advance-time" class="small-input" min="0.1" max="60" step="0.1" value="" placeholder="3">
                    </div>
                </div>
                
                <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                    <span id="mode-description">El juego usar√° el tiempo de memorizaci√≥n configurado.</span>
                </p>
            </div>

            <!-- Recall -->
            <div class="section">
                <h3 class="section-title">4. Recall</h3>
                
                <div class="timer-config">
                    <div class="timer-option">
                        <label for="recall-timer">Tiempo para recall (segundos):</label>
                        <input type="number" id="recall-timer" class="timer-select" min="1" max="3600" step="0.1" value="" placeholder="30">
                        <div id="recall-time-conversion" style="font-size: 0.9rem; color: #666; margin-top: 5px;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Configuraci√≥n de Rondas -->
            <div class="section">
                <h3 class="section-title">5. Rondas</h3>
                <p>Elige cu√°ntas rondas quieres jugar:</p>
                <div class="digits-input-container">
                    <input type="number" id="rounds-input" class="digits-input" min="1" max="100" value="" placeholder="10">
                    <span style="font-size: 1.1rem; color: #333;">rondas</span>
                </div>
                <p id="rounds-info">Jugar√°s 10 rondas en total</p>
            </div>

            <!-- Controles Especiales Configurables -->
            <div class="section">
                <h3 class="section-title">6. Controles Especiales de Teclado</h3>
                <p>Configura los valores binarios que se insertar√°n al presionar cada tecla num√©rica (0-7):</p>
                <p style="font-size: 0.9rem; color: #666; margin: 10px 0;">
                    ‚ÑπÔ∏è <strong>Nota:</strong> Las teclas son fijas (0-7), pero puedes <strong>editar y borrar libremente</strong> los valores binarios que produce cada una.
                    <span id="save-confirmation" style="display: none; color: #28a745; font-weight: bold; margin-left: 10px;">‚úÖ ¬°Guardado!</span>
                </p>
                <p style="font-size: 0.85rem; color: #007bff; margin: 10px 0;">
                    üí° <strong>Tip:</strong> Haz clic en un campo para seleccionar todo el texto y editarlo f√°cilmente. Los cambios se guardan autom√°ticamente.
                </p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; background: white;">
                        <label style="font-weight: bold; color: #fff; background: #007bff; padding: 5px 10px; border-radius: 5px; min-width: 50px; text-align: center;">0</label>
                        <span style="color: #666;">‚Üí</span>
                        <input type="text" id="key-0" class="small-input" value="000" maxlength="3" placeholder="000" style="font-family: 'Courier New', monospace; border: 2px solid #28a745; flex: 1;" title="Haz clic para editar. Puedes borrar y escribir libremente. Solo acepta 0 y 1.">
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; background: white;">
                        <label style="font-weight: bold; color: #fff; background: #007bff; padding: 5px 10px; border-radius: 5px; min-width: 50px; text-align: center;">1</label>
                        <span style="color: #666;">‚Üí</span>
                        <input type="text" id="key-1" class="small-input" value="001" maxlength="3" placeholder="001" style="font-family: 'Courier New', monospace; border: 2px solid #28a745; flex: 1;" title="Haz clic para editar. Puedes borrar y escribir libremente. Solo acepta 0 y 1.">
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; background: white;">
                        <label style="font-weight: bold; color: #fff; background: #007bff; padding: 5px 10px; border-radius: 5px; min-width: 50px; text-align: center;">2</label>
                        <span style="color: #666;">‚Üí</span>
                        <input type="text" id="key-2" class="small-input" value="011" maxlength="3" placeholder="011" style="font-family: 'Courier New', monospace; border: 2px solid #28a745; flex: 1;" title="Haz clic para editar. Puedes borrar y escribir libremente. Solo acepta 0 y 1.">
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; background: white;">
                        <label style="font-weight: bold; color: #fff; background: #007bff; padding: 5px 10px; border-radius: 5px; min-width: 50px; text-align: center;">3</label>
                        <span style="color: #666;">‚Üí</span>
                        <input type="text" id="key-3" class="small-input" value="111" maxlength="3" placeholder="111" style="font-family: 'Courier New', monospace; border: 2px solid #28a745; flex: 1;" title="Haz clic para editar. Puedes borrar y escribir libremente. Solo acepta 0 y 1.">
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; background: white;">
                        <label style="font-weight: bold; color: #fff; background: #007bff; padding: 5px 10px; border-radius: 5px; min-width: 50px; text-align: center;">4</label>
                        <span style="color: #666;">‚Üí</span>
                        <input type="text" id="key-4" class="small-input" value="100" maxlength="3" placeholder="100" style="font-family: 'Courier New', monospace; border: 2px solid #28a745; flex: 1;" title="Haz clic para editar. Puedes borrar y escribir libremente. Solo acepta 0 y 1.">
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; background: white;">
                        <label style="font-weight: bold; color: #fff; background: #007bff; padding: 5px 10px; border-radius: 5px; min-width: 50px; text-align: center;">5</label>
                        <span style="color: #666;">‚Üí</span>
                        <input type="text" id="key-5" class="small-input" value="101" maxlength="3" placeholder="101" style="font-family: 'Courier New', monospace; border: 2px solid #28a745; flex: 1;" title="Haz clic para editar. Puedes borrar y escribir libremente. Solo acepta 0 y 1.">
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; background: white;">
                        <label style="font-weight: bold; color: #fff; background: #007bff; padding: 5px 10px; border-radius: 5px; min-width: 50px; text-align: center;">6</label>
                        <span style="color: #666;">‚Üí</span>
                        <input type="text" id="key-6" class="small-input" value="110" maxlength="3" placeholder="110" style="font-family: 'Courier New', monospace; border: 2px solid #28a745; flex: 1;" title="Haz clic para editar. Puedes borrar y escribir libremente. Solo acepta 0 y 1.">
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; background: white;">
                        <label style="font-weight: bold; color: #fff; background: #007bff; padding: 5px 10px; border-radius: 5px; min-width: 50px; text-align: center;">7</label>
                        <span style="color: #666;">‚Üí</span>
                        <input type="text" id="key-7" class="small-input" value="010" maxlength="3" placeholder="010" style="font-family: 'Courier New', monospace; border: 2px solid #28a745; flex: 1;" title="Haz clic para editar. Puedes borrar y escribir libremente. Solo acepta 0 y 1.">
                    </div>
                </div>
                <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                    üí° Tip: Durante la fase de escritura, presiona estas teclas para rellenar autom√°ticamente 3 d√≠gitos binarios y avanzar al siguiente campo.
                </p>
                <div style="text-align: center; margin-top: 15px;">
                    <button onclick="resetSpecialKeysToDefault()" style="
                        padding: 10px 20px; 
                        background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%); 
                        color: white; 
                        border: none; 
                        border-radius: 8px; 
                        cursor: pointer; 
                        font-size: 1rem;
                        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 12px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.2)'">
                        üîÑ Restaurar valores por defecto
                    </button>
                </div>
            </div>

            <!-- Resumen de Configuraci√≥n -->
            <div id="config-summary" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px; padding: 25px; margin: 25px 0; border: 2px solid #dee2e6; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <h3 style="margin: 0 0 20px 0; color: #495057; font-size: 1.4rem; text-align: center; border-bottom: 2px solid #dee2e6; padding-bottom: 10px;">
                    üìã Resumen de Configuraci√≥n
                </h3>
                
                <!-- Informaci√≥n Principal -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <!-- N√∫meros -->
                    <div style="background: white; padding: 15px; border-radius: 10px; border-left: 5px solid #007bff; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h4 style="margin: 0 0 8px 0; color: #007bff; font-size: 1rem;">üî¢ N√∫meros</h4>
                        <p id="summary-digits" style="margin: 0; font-size: 1.1rem; font-weight: bold; color: #333;">Cargando...</p>
                    </div>
                    
                    <!-- Rondas -->
                    <div style="background: white; padding: 15px; border-radius: 10px; border-left: 5px solid #28a745; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h4 style="margin: 0 0 8px 0; color: #28a745; font-size: 1rem;">üîÑ Rondas</h4>
                        <p id="summary-rounds" style="margin: 0; font-size: 1.1rem; font-weight: bold; color: #333;">Cargando...</p>
                    </div>
                </div>
                
                <!-- Visualizaci√≥n -->
                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 5px solid #6f42c1; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <h4 style="margin: 0 0 8px 0; color: #6f42c1; font-size: 1rem;">üëÅÔ∏è Visualizaci√≥n</h4>
                    <p id="summary-display" style="margin: 0; font-size: 1.1rem; font-weight: bold; color: #333;">Cargando...</p>
                </div>
                
                <!-- Tiempo de Memorizaci√≥n -->
                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 5px solid #ffc107; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <h4 style="margin: 0 0 8px 0; color: #ffc107; font-size: 1rem;">‚è±Ô∏è Tiempo de Memorizaci√≥n</h4>
                    <p id="summary-mode" style="margin: 0; font-size: 1.1rem; font-weight: bold; color: #333;">Cargando...</p>
                </div>
                
                <!-- Recall -->
                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 5px solid #17a2b8; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <h4 style="margin: 0 0 8px 0; color: #17a2b8; font-size: 1rem;">üìù Recall</h4>
                    <p id="summary-timers" style="margin: 0; font-size: 1.1rem; font-weight: bold; color: #333;">Cargando...</p>
                </div>
                
                <!-- Controles Especiales -->
                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 5px solid #20c997; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <h4 style="margin: 0 0 8px 0; color: #20c997; font-size: 1rem;">‚å®Ô∏è Controles Especiales</h4>
                    <p id="summary-controls" style="margin: 0; font-size: 1.1rem; font-weight: bold; color: #333;">Cargando...</p>
                </div>
                
                <!-- Tiempos Estimados -->
                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 5px solid #dc3545; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <h4 style="margin: 0 0 8px 0; color: #dc3545; font-size: 1rem;">‚è∞ Tiempos Estimados</h4>
                    <div id="summary-times" style="color: #333;">
                        <p style="margin: 5px 0; font-size: 1rem;"><strong>Tiempo por ronda:</strong> <span id="time-per-round">Cargando...</span></p>
                        <p style="margin: 5px 0; font-size: 1rem;"><strong>Tiempo total:</strong> <span id="time-total">Cargando...</span></p>
                        <p style="margin: 5px 0; font-size: 0.9rem; color: #666;"><span id="time-breakdown">Cargando...</span></p>
                    </div>
                </div>
            </div>
            
            <button class="button" onclick="startGame()">Comenzar Juego</button>
        </div>

        <!-- Fase de Preparaci√≥n -->
        <div id="preparation-phase" class="hidden">
            <h2 class="phase-title">Preparaci√≥n</h2>
            <div class="prep-wrapper">
                <div class="prep-circle">
                    <div class="prep-count" id="prep-countdown">5</div>
                </div>
                <div class="prep-subtitle"><strong>Prep√°rate, la memorizaci√≥n comienza en breve...</strong></div>
            </div>
        </div>

        <!-- Fase de Memorizaci√≥n -->
        <div id="memorization-phase" class="hidden">
            <h2 class="phase-title">Fase de Memorizaci√≥n</h2>
            <div class="timer" id="timer">Tiempo restante: 15 segundos</div>
            <div class="timer" id="elapsed-time" style="color: #1976d2; font-weight: bold;">Tiempo empleado: 0.0 segundos</div>
            <div class="number-display" id="number-display"></div>
            <div class="progress-indicator" id="progress">N√∫meros 1-2 de 5</div>
            <div style="margin: 20px 0;">
                <button class="button" id="prev-btn" onclick="previousNumber()" disabled>‚Üê Anterior</button>
                <button class="button" id="next-btn" onclick="nextNumber()">Siguiente ‚Üí</button>
            </div>
            <p id="memorization-info">Memoriza estos n√∫meros. Tienes 15 segundos.</p>
            <div style="margin: 30px 0;">
                <button class="button" id="finish-memorization-btn" onclick="finishMemorization()">Terminar Memorizaci√≥n</button>
            </div>
        </div>

        <!-- Fase de Escritura -->
        <div id="input-phase" class="hidden">
            <h2 class="phase-title">Escribe los N√∫meros</h2>
            <div class="timer" id="recall-timer-display">Tiempo restante: 30 segundos</div>
            <p>Escribe los n√∫meros de forma continua usando el teclado, o haz clic en cualquier d√≠gito para editarlo directamente:</p>
            <p style="color: #007bff; font-weight: bold;">üí° Tip: Usa las flechas ‚Üê ‚Üí del teclado para navegar entre d√≠gitos</p>
            
            <!-- Informaci√≥n sobre controles especiales -->
            <div id="special-controls-info" style="background: #e3f2fd; border: 2px solid #bbdefb; border-radius: 10px; padding: 15px; margin: 15px 0; text-align: center; font-size: 0.9rem; color: #1976d2;">
                <strong>üéÆ Controles Especiales:</strong><br>
                <span style="font-size: 0.8rem;">Teclas 0-7 rellenan 3 d√≠gitos autom√°ticamente</span><br>
                <span style="font-size: 0.75rem; color: #666;">Configuraci√≥n: ${Object.entries(specialKeys).map(([key, value]) => `Tecla ${key}=${value}`).join(', ')}</span>
            </div>
            
            <!-- Input continuo para escritura r√°pida -->
            <div class="continuous-input-container">
                <label for="continuous-input">Escritura continua (recomendado):</label>
                <input type="text" id="continuous-input" class="continuous-input" placeholder="Escribe todos los n√∫meros seguidos aqu√≠..." maxlength="999">
                <p class="input-hint">Simplemente escribe los n√∫meros y se distribuir√°n autom√°ticamente. Tambi√©n puedes hacer clic en cualquier d√≠gito para editarlo directamente.</p>
                <p class="input-hint" style="color: #007bff; font-weight: bold;">üí° Tip: Puedes escribir directamente sin hacer clic en ning√∫n lugar. Solo presiona las teclas num√©ricas y se llenar√°n autom√°ticamente. Tambi√©n puedes hacer clic en cualquier d√≠gito para editarlo directamente.</p>
            </div>
            
            <div id="digits-input-container" class="digits-grid"></div>
            
            <!-- Informaci√≥n de p√°gina -->
            <div style="margin: 20px 0; text-align: center;">
                <div id="input-page-info" style="font-size: 1.1rem; color: #666; margin-bottom: 10px;">Escribe todos los n√∫meros binarios memorizados</div>
            </div>
            
            <div>
                <button class="button" onclick="checkAnswer()" id="verify-btn">Verificar Respuesta</button>
                <button class="button" onclick="showNumberAgain()" id="show-again-btn">Ver de Nuevo</button>
            </div>
        </div>

                 <!-- Fase de Resultado -->
         <div id="result-phase" class="hidden">
             <h2 class="phase-title">Resultado Ronda <span id="current-round-display">1</span></h2>
             <div id="result-message"></div>
             
             <!-- Resultado de la Ronda Actual -->
             <div class="section">
                 <h3 class="section-title">Resultado Ronda <span id="current-round-number">1</span></h3>
                 
                 <!-- Estad√≠sticas de la ronda -->
                 <div class="stats-grid" id="round-stats-grid">
                     <div class="stat-card">
                         <div class="stat-label">Porcentaje de Acierto</div>
                         <div class="stat-number neutral" id="round-accuracy">0%</div>
                         <div style="font-size: 0.9rem; color: #666;">d√≠gitos correctos</div>
                     </div>
                     <div class="stat-card">
                         <div class="stat-label">Estado</div>
                         <div class="stat-number neutral" id="round-status">Pendiente</div>
                         <div style="font-size: 0.9rem; color: #666;">de la ronda</div>
                     </div>
                 </div>
             </div>
             
             <!-- Comparaci√≥n visual de resultados -->
             <div id="visual-comparison-container" class="visual-comparison"></div>
             
             <!-- Progresi√≥n de Rondas -->
             <div class="section">
                 <h3 class="section-title">Progresi√≥n de Rondas</h3>
                 
                 <!-- Lista simple de porcentajes por ronda -->
                 <div id="rounds-percentage-list" style="margin: 20px 0; text-align: center;">
                     <!-- Aqu√≠ se mostrar√°n los porcentajes de cada ronda -->
                 </div>
                 
                 <!-- Estad√≠sticas totales -->
                 <div class="stats-grid" id="progress-stats-grid">
                     <div class="stat-card">
                         <div class="stat-label">Rondas Correctas</div>
                         <div class="stat-number neutral" id="current-score">0</div>
                         <div style="font-size: 0.9rem; color: #666;">de <span id="current-round">1</span></div>
                     </div>
                     <div class="stat-card">
                         <div class="stat-label">Promedio Precisi√≥n</div>
                         <div class="stat-number neutral" id="current-percentage">0%</div>
                         <div style="font-size: 0.9rem; color: #666;">de d√≠gitos correctos</div>
                     </div>
                     <div class="stat-card">
                         <div class="stat-label">Mejor Racha</div>
                         <div class="stat-number neutral" id="current-streak">0</div>
                         <div style="font-size: 0.9rem; color: #666;">consecutivas</div>
                     </div>
                 </div>
             </div>
             
             <!-- Configuraci√≥n de tiempo para siguiente ronda -->
             <div class="section">
                 <h3 class="section-title">Configuraci√≥n para Siguiente Ronda</h3>
                 
                 <div class="mode-selector">
                     <div class="mode-option">
                         <input type="radio" id="result-memorization-mode" name="result-time-mode" value="memorization" class="mode-radio" checked>
                         <label for="result-memorization-mode">Tiempo para memorizaci√≥n (segundos):</label>
                         <input type="number" id="result-memorization-timer" class="timer-select" min="1" max="999999" step="0.1" value="" placeholder="15">
                         <div id="result-memorization-time-conversion" style="font-size: 0.9rem; color: #666; margin-top: 5px;"></div>
                     </div>
                     
                     <div class="mode-option">
                         <input type="radio" id="result-auto-advance-mode" name="result-time-mode" value="auto-advance" class="mode-radio">
                         <label for="result-auto-advance-mode">Autoavance (segundos):</label>
                         <input type="number" id="result-auto-advance-time" class="small-input" min="0.1" max="60" step="0.1" value="" placeholder="3">
                     </div>
                 </div>
                 
                 <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                     <span id="result-mode-description">El juego usar√° el tiempo de memorizaci√≥n configurado.</span>
                 </p>
             </div>
             
             <div id="round-progress">
                 <p>Ronda <span id="round-number">1</span> de <span id="total-rounds">10</span></p>
                 <div class="progress-bar">
                     <div class="progress-fill" id="round-progress-fill"></div>
                 </div>
             </div>
             <div>
                 <button class="button" onclick="nextRound()" id="next-round-btn">Siguiente Ronda</button>
                 <button class="button" onclick="resetGame()" id="new-game-btn">Nuevo Juego</button>
                 <button class="button" onclick="goToMenu()" id="menu-btn" style="display: none;">Men√∫</button>
             </div>
         </div>
         
         <!-- Fase de Resultados Finales -->
         <div id="final-results-phase" class="hidden">
             <h2 class="phase-title">¬°Juego Completado!</h2>
             
             <!-- Gr√°ficas circulares principales -->
             <div class="chart-container">
                 <div>
                     <div class="pie-chart" id="final-accuracy-chart">
                         <div class="pie-chart-text">0%</div>
                     </div>
                     <div class="chart-label">Precisi√≥n Final</div>
                 </div>
                 <div>
                     <div class="pie-chart" id="final-score-chart">
                         <div class="pie-chart-text">0/10</div>
                     </div>
                     <div class="chart-label">Progreso</div>
                 </div>
                 <div>
                     <div class="pie-chart" id="final-streak-chart">
                         <div class="pie-chart-text">0</div>
                     </div>
                     <div class="chart-label">Mejor Racha</div>
                 </div>
             </div>
             
             <!-- Estad√≠sticas finales detalladas -->
             <div class="stats-grid">
                 <div class="stat-card">
                     <div class="stat-label">Puntuaci√≥n Total</div>
                     <div class="stat-number neutral" id="final-total-score">0</div>
                     <div style="font-size: 0.9rem; color: #666;">de <span id="final-total-rounds">10</span></div>
                 </div>
                 <div class="stat-card">
                     <div class="stat-label">Porcentaje Final</div>
                     <div class="stat-number neutral" id="final-score-percentage">0%</div>
                     <div style="font-size: 0.9rem; color: #666;">de acierto</div>
                 </div>
                 <div class="stat-card">
                     <div class="stat-label">Rondas Correctas</div>
                     <div class="stat-number correct" id="final-correct-rounds">0</div>
                     <div style="font-size: 0.9rem; color: #666;">de <span id="final-total-rounds-2">10</span></div>
                 </div>
                 <div class="stat-card">
                     <div class="stat-label">Mejor Racha</div>
                     <div class="stat-number neutral" id="final-best-streak">0</div>
                     <div style="font-size: 0.9rem; color: #666;">consecutivas</div>
                 </div>
             </div>
             
             <!-- Progresi√≥n visual completa -->
             <div class="round-breakdown">
                 <h4>Progresi√≥n Completa:</h4>
                 <div class="rounds-grid" id="final-rounds-breakdown"></div>
             </div>
             
             <!-- Resumen de rendimiento -->
             <div class="performance-summary">
                 <h4>An√°lisis de Rendimiento:</h4>
                 <div id="final-performance-stats"></div>
             </div>
             
             <div>
                 <button class="button" onclick="resetGame()">Jugar de Nuevo</button>
             </div>
         </div>
    </div>

    <script>
        let gameState = 'setup';
        let selectedDigits = 5;
        let numberSequence = [];
        let currentNumberIndex = 0;
        let userInput = '';
        let isCorrect = null;
        let timer = 0;
        let memorizationTime = 15;
        let recallTime = 30;
        let timerInterval;
        let recallTimerInterval;
        let memorizationStartTime = 0;
        let actualMemorizationTime = 0;
        
        // Variables para autoavance
        let autoAdvanceEnabled = false;
        let autoAdvanceTime = 3;
        let autoAdvanceTimer = 0;
        let autoAdvanceInterval;
        let currentMode = 'memorization'; // 'memorization' o 'auto-advance'
        let displayMode = 'single'; // 'single', 'pairs' o 'triple'
        let direction = 'horizontal'; // 'horizontal' o 'vertical'
        let specialMatrixMode = false; // Modo especial: matriz 3x6
        let currentInputPage = 0; // Para la paginaci√≥n en la fase de escritura
        let results = []; // Para almacenar resultados detallados
        
        // Configuraci√≥n de controles especiales - valores por defecto
        const defaultSpecialKeys = {
            '0': '000',
            '1': '001', 
            '2': '011',
            '3': '111',
            '4': '100',
            '5': '101',
            '6': '110',
            '7': '010'
        };
        
        // Cargar configuraci√≥n desde localStorage o usar valores por defecto
        let specialKeys = loadSpecialKeysFromStorage();
        
        // Variables para sistema de rondas
        let currentRound = 1;
        let totalRounds = 10;
        let roundScores = []; // Array para almacenar puntuaciones de cada ronda
        let totalScore = 0;

        // Generar secuencia de pares de n√∫meros binarios de 3 d√≠gitos o matrices 3x6
        function generateNumberSequence() {
            numberSequence = [];
            
            if (specialMatrixMode) {
                // Modo especial: Generar matrices de 3x6 (3 filas de 6 d√≠gitos)
                for (let i = 0; i < selectedDigits; i++) {
                    const row1 = Array.from({length: 6}, () => Math.floor(Math.random() * 2)).join('');
                    const row2 = Array.from({length: 6}, () => Math.floor(Math.random() * 2)).join('');
                    const row3 = Array.from({length: 6}, () => Math.floor(Math.random() * 2)).join('');
                    const matrix = row1 + '\n' + row2 + '\n' + row3;
                    numberSequence.push(matrix);
                }
            } else {
                // Modo normal: Generar pares de n√∫meros binarios de 3 d√≠gitos
                for (let i = 0; i < selectedDigits; i++) {
                    // Generar dos n√∫meros binarios de 3 d√≠gitos (000-111) para formar un par
                    const binaryNumber1 = Math.floor(Math.random() * 8).toString(2).padStart(3, '0');
                    const binaryNumber2 = Math.floor(Math.random() * 8).toString(2).padStart(3, '0');
                    // Crear par con salto de l√≠nea: "111\n000"
                    const pair = binaryNumber1 + '\n' + binaryNumber2;
                    numberSequence.push(pair);
                }
            }
        }

        // Configurar entrada de n√∫meros a memorizar
        document.getElementById('digits-input').addEventListener('input', function() {
            // Si el usuario est√° borrando, permitir que el campo est√© vac√≠o temporalmente
            if (this.value === '') {
                selectedDigits = 0;
                document.getElementById('selected-info').textContent = 'Escribe cu√°ntos n√∫meros quieres memorizar';
                updateSummary();
                updateModeDescription();
                return;
            }
            
            selectedDigits = parseInt(this.value) || 0;
            if (selectedDigits < 1) selectedDigits = 1;
            if (selectedDigits > 999999) selectedDigits = 999999;
            this.value = selectedDigits;
            
            const pages = Math.ceil(selectedDigits / (displayMode === 'single' ? 1 : displayMode === 'pairs' ? 2 : 3));
            document.getElementById('selected-info').textContent = `Memorizar√°s ${selectedDigits} grupos de n√∫meros binarios de 3 d√≠gitos (${pages} p√°ginas)`;
            updateSummary();
            updateModeDescription();
            updateDisplayInfo();
        });
        
        // Establecer valor por defecto solo cuando el campo est√© vac√≠o y el usuario haya terminado de escribir
        document.getElementById('digits-input').addEventListener('blur', function() {
            if (!this.value || this.value === '') {
                this.value = '5';
                selectedDigits = 5;
                const pages = Math.ceil(selectedDigits / 2);
                document.getElementById('selected-info').textContent = `Memorizar√°s ${selectedDigits} n√∫meros del 00-99 (${pages} p√°ginas)`;
                updateSummary();
                updateModeDescription();
                updateDisplayInfo();
            }
        });

        // Configurar entrada de n√∫mero de rondas
        document.getElementById('rounds-input').addEventListener('input', function() {
            // Si el usuario est√° borrando, permitir que el campo est√© vac√≠o temporalmente
            if (this.value === '') {
                totalRounds = 0;
                document.getElementById('rounds-info').textContent = 'Escribe cu√°ntas rondas quieres jugar';
                updateSummary();
                return;
            }
            
            totalRounds = parseInt(this.value) || 0;
            if (totalRounds < 1) totalRounds = 1;
            if (totalRounds > 100) totalRounds = 100;
            this.value = totalRounds;
            
            document.getElementById('rounds-info').textContent = `Jugar√°s ${totalRounds} rondas en total`;
            updateSummary();
        });
        
        // Establecer valor por defecto para rondas
        document.getElementById('rounds-input').addEventListener('blur', function() {
            if (!this.value || this.value === '') {
                this.value = '10';
                totalRounds = 10;
                document.getElementById('rounds-info').textContent = `Jugar√°s ${totalRounds} rondas en total`;
                updateSummary();
            }
        });

        // Funci√≥n para convertir segundos a minutos y segundos
        function formatTimeDisplay(seconds) {
            if (seconds < 60) {
                return `${seconds} segundos`;
            } else {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = Math.round(seconds % 60);
                if (remainingSeconds === 0) {
                    return `${minutes} minuto${minutes > 1 ? 's' : ''}`;
                } else {
                    return `${minutes} minuto${minutes > 1 ? 's' : ''} y ${remainingSeconds} segundo${remainingSeconds > 1 ? 's' : ''}`;
                }
            }
        }

        // Configurar temporizadores (estos event listeners se manejan en DOMContentLoaded)

        // Configurar modo de tiempo
        document.getElementById('memorization-mode').addEventListener('change', function() {
            if (this.checked) {
                currentMode = 'memorization';
                autoAdvanceEnabled = false;
                updateModeDescription();
                updateSummary();
                
                // Mostrar bot√≥n "Ver de Nuevo"
                document.getElementById('show-again-btn').style.display = 'inline-block';
            }
        });

        document.getElementById('auto-advance-mode').addEventListener('change', function() {
            if (this.checked) {
                currentMode = 'auto-advance';
                autoAdvanceEnabled = true;
                updateModeDescription();
                updateSummary();
                
                // Ocultar bot√≥n "Ver de Nuevo"
                document.getElementById('show-again-btn').style.display = 'none';
            }
        });

        // Configurar tiempo de autoavance
        document.getElementById('auto-advance-time').addEventListener('input', function() {
            autoAdvanceTime = parseFloat(this.value) || 3;
            updateSummary();
            updateModeDescription();
        });
        
        // Event listeners para modo de visualizaci√≥n
        document.getElementById('single-group-mode').addEventListener('change', function() {
            if (this.checked) {
                displayMode = 'single';
                updateDisplayInfo();
                updateSummary();
            }
        });
        
        document.getElementById('pairs-mode').addEventListener('change', function() {
            if (this.checked) {
                displayMode = 'pairs';
                updateDisplayInfo();
                updateSummary();
            }
        });
        
        document.getElementById('triple-mode').addEventListener('change', function() {
            if (this.checked) {
                displayMode = 'triple';
                updateDisplayInfo();
                updateSummary();
            }
        });
        
        // Event listener para modo especial de matriz 3x6
        document.getElementById('special-matrix-mode').addEventListener('change', function() {
            specialMatrixMode = this.checked;
            toggleSpecialMatrixMode(this.checked);
            updateDisplayInfo();
            updateSummary();
        });
        
        // Funci√≥n para habilitar/deshabilitar selectores cuando se activa el modo especial
        function toggleSpecialMatrixMode(enabled) {
            const directionSelector = document.getElementById('direction-selector');
            const groupsSelector = document.getElementById('groups-selector');
            const directionRadios = document.querySelectorAll('input[name="direction-mode"]');
            const displayRadios = document.querySelectorAll('input[name="display-mode"]');
            
            if (enabled) {
                // Deshabilitar y atenuar los selectores
                directionSelector.style.opacity = '0.4';
                directionSelector.style.pointerEvents = 'none';
                groupsSelector.style.opacity = '0.4';
                groupsSelector.style.pointerEvents = 'none';
                
                directionRadios.forEach(radio => radio.disabled = true);
                displayRadios.forEach(radio => radio.disabled = true);
            } else {
                // Habilitar los selectores
                directionSelector.style.opacity = '1';
                directionSelector.style.pointerEvents = 'auto';
                groupsSelector.style.opacity = '1';
                groupsSelector.style.pointerEvents = 'auto';
                
                directionRadios.forEach(radio => radio.disabled = false);
                displayRadios.forEach(radio => radio.disabled = false);
            }
        }
        
        // Event listeners para direcci√≥n de visualizaci√≥n
        document.getElementById('horizontal-direction').addEventListener('change', function() {
            if (this.checked) {
                direction = 'horizontal';
                updateDirectionInfo();
                updateDisplayInfo();
                updateSummary();
            }
        });
        
        document.getElementById('vertical-direction').addEventListener('change', function() {
            if (this.checked) {
                direction = 'vertical';
                updateDirectionInfo();
                updateDisplayInfo();
                updateSummary();
            }
        });

        // Actualizar descripci√≥n del modo
        function updateModeDescription() {
            const description = document.getElementById('mode-description');
            if (currentMode === 'memorization') {
                if (memorizationTime > 0) {
                    description.textContent = `El juego usar√° el tiempo de memorizaci√≥n configurado (${memorizationTime.toFixed(1)} segundos).`;
                } else {
                    description.textContent = `El juego usar√° el tiempo de memorizaci√≥n configurado (escribe un tiempo).`;
                }
            } else {
                let pages = selectedDigits;
                if (displayMode === 'pairs') {
                    pages = Math.ceil(selectedDigits / 2);
                } else if (displayMode === 'triple') {
                    pages = Math.ceil(selectedDigits / 3);
                }
                
                if (autoAdvanceTime > 0) {
                    const totalTime = pages * autoAdvanceTime;
                    description.textContent = `El juego avanzar√° autom√°ticamente cada ${autoAdvanceTime.toFixed(1)} segundos por p√°gina (${totalTime.toFixed(1)} segundos total).`;
                } else {
                    description.textContent = `El juego avanzar√° autom√°ticamente cada (escribe tiempo) segundos por p√°gina.`;
                }
            }
        }
        
        // Actualizar informaci√≥n de direcci√≥n
        function updateDirectionInfo() {
            const directionInfo = document.getElementById('direction-info');
            if (direction === 'horizontal') {
                directionInfo.textContent = 'Disposici√≥n horizontal: grupos separados por p√°ginas.';
            } else {
                directionInfo.textContent = 'Disposici√≥n vertical: todos los grupos en un solo tablero alto.';
            }
        }
        
        // Actualizar informaci√≥n de visualizaci√≥n
        function updateDisplayInfo() {
            const displayInfo = document.getElementById('display-info');
            const selectedInfo = document.getElementById('selected-info');
            
            let pages, displayText;
            
            // Si est√° activado el modo especial de matriz 3x6
            if (specialMatrixMode) {
                pages = selectedDigits;
                displayText = `‚≠ê Modo Especial: Ver√°s matrices de 3√ó6 (18 d√≠gitos binarios por grupo), 1 grupo por p√°gina (${pages} p√°ginas).`;
                selectedInfo.textContent = `Memorizar√°s ${selectedDigits} matrices de 3√ó6 (18 d√≠gitos binarios cada una)`;
                displayInfo.textContent = displayText;
                return;
            }
            
            if (direction === 'horizontal') {
                // Modo horizontal (actual)
                if (displayMode === 'single') {
                    pages = selectedDigits;
                    displayText = `Ver√°s los grupos de n√∫meros binarios de 1 por p√°gina (${pages} p√°ginas) con disposici√≥n horizontal.`;
                    selectedInfo.textContent = `Memorizar√°s ${selectedDigits} grupos de n√∫meros binarios de 3 d√≠gitos (1 grupo por p√°gina)`;
                } else if (displayMode === 'pairs') {
                    pages = Math.ceil(selectedDigits / 2);
                    displayText = `Ver√°s los grupos de n√∫meros binarios de 2 por p√°gina (${pages} p√°ginas) con disposici√≥n horizontal.`;
                    selectedInfo.textContent = `Memorizar√°s ${selectedDigits} grupos de n√∫meros binarios de 3 d√≠gitos (2 grupos por p√°gina)`;
                } else if (displayMode === 'triple') {
                    pages = Math.ceil(selectedDigits / 3);
                    displayText = `Ver√°s los grupos de n√∫meros binarios de 3 por p√°gina (${pages} p√°ginas) con disposici√≥n horizontal.`;
                    selectedInfo.textContent = `Memorizar√°s ${selectedDigits} grupos de n√∫meros binarios de 3 d√≠gitos (3 grupos por p√°gina)`;
                }
            } else {
                // Modo vertical (nuevo) - separar por p√°ginas seg√∫n la selecci√≥n
                if (displayMode === 'single') {
                    pages = selectedDigits;
                    displayText = `Ver√°s los grupos de n√∫meros binarios de 1 por p√°gina (${pages} p√°ginas) con disposici√≥n vertical.`;
                    selectedInfo.textContent = `Memorizar√°s ${selectedDigits} grupos de n√∫meros binarios de 3 d√≠gitos (1 grupo por p√°gina)`;
                } else if (displayMode === 'pairs') {
                    pages = Math.ceil(selectedDigits / 2);
                    displayText = `Ver√°s los grupos de n√∫meros binarios de 2 por p√°gina (${pages} p√°ginas) con disposici√≥n vertical.`;
                    selectedInfo.textContent = `Memorizar√°s ${selectedDigits} grupos de n√∫meros binarios de 3 d√≠gitos (2 grupos por p√°gina)`;
                } else if (displayMode === 'triple') {
                    pages = Math.ceil(selectedDigits / 3);
                    displayText = `Ver√°s los grupos de n√∫meros binarios de 3 por p√°gina (${pages} p√°ginas) con disposici√≥n vertical.`;
                    selectedInfo.textContent = `Memorizar√°s ${selectedDigits} grupos de n√∫meros binarios de 3 d√≠gitos (3 grupos por p√°gina)`;
                }
            }
            
            displayInfo.textContent = displayText;
        }

        // Actualizar resumen
        function updateSummary() {
            let pages = selectedDigits;
            let displayText = 'individual';
            let directionText = direction === 'horizontal' ? 'horizontal' : 'vertical';
            
            // Si est√° activado el modo especial de matriz 3x6
            if (specialMatrixMode) {
                displayText = '‚≠ê Matriz 3√ó6';
                directionText = '1 por p√°gina';
                
                // Actualizar apartado de N√∫meros
                if (selectedDigits > 0) {
                    document.getElementById('summary-digits').textContent = `${selectedDigits} matrices (${selectedDigits} p√°ginas)`;
                } else {
                    document.getElementById('summary-digits').textContent = '(escribe un n√∫mero)';
                }
                
                // Actualizar apartado de Visualizaci√≥n
                document.getElementById('summary-display').textContent = `${displayText} (${directionText})`;
                
                // Actualizar informaci√≥n de rondas
                if (totalRounds > 0) {
                    document.getElementById('summary-rounds').textContent = `Rondas: ${totalRounds}`;
                } else {
                    document.getElementById('summary-rounds').textContent = `Rondas: (escribe un n√∫mero)`;
                }
                
                // Manejar temporizadores vac√≠os
                const memorizationText = memorizationTime > 0 ? `${memorizationTime.toFixed(1)}s` : '(escribe tiempo)';
                const recallText = recallTime > 0 ? `${recallTime.toFixed(1)}s` : '(escribe tiempo)';
                document.getElementById('summary-timers').textContent = `${recallText}`;
                
                if (currentMode === 'memorization') {
                    const modeText = memorizationTime > 0 ? `(${memorizationTime.toFixed(1)}s)` : '(escribe tiempo)';
                    document.getElementById('summary-mode').textContent = `Modo: Tiempo de memorizaci√≥n ${modeText}`;
                } else {
                    const modeText = autoAdvanceTime > 0 ? `(${autoAdvanceTime.toFixed(1)}s)` : '(escribe tiempo)';
                    document.getElementById('summary-mode').textContent = `Modo: Autoavance ${modeText}`;
                }
                
                // Actualizar tiempos estimados
                updateTimeEstimates();
                
                return;
            }
            
            if (direction === 'horizontal') {
                // Modo horizontal (actual)
                if (displayMode === 'pairs') {
                    pages = Math.ceil(selectedDigits / 2);
                    displayText = 'parejas';
                } else if (displayMode === 'triple') {
                    pages = Math.ceil(selectedDigits / 3);
                    displayText = 'triple';
                }
            } else {
                // Modo vertical (nuevo) - separar por p√°ginas seg√∫n la selecci√≥n
                if (displayMode === 'pairs') {
                    pages = Math.ceil(selectedDigits / 2);
                    displayText = 'parejas';
                } else if (displayMode === 'triple') {
                    pages = Math.ceil(selectedDigits / 3);
                    displayText = 'triple';
                }
            }
            
            // Actualizar apartado de N√∫meros (solo cantidad)
            if (selectedDigits > 0) {
                document.getElementById('summary-digits').textContent = `${selectedDigits} grupos (${pages} p√°ginas)`;
            } else {
                document.getElementById('summary-digits').textContent = '(escribe un n√∫mero)';
            }
            
            // Actualizar apartado de Visualizaci√≥n (modo y direcci√≥n)
            document.getElementById('summary-display').textContent = `${displayText} (${directionText})`;
            
            // Actualizar informaci√≥n de rondas
            if (totalRounds > 0) {
                document.getElementById('summary-rounds').textContent = `Rondas: ${totalRounds}`;
            } else {
                document.getElementById('summary-rounds').textContent = `Rondas: (escribe un n√∫mero)`;
            }
            
            // Manejar temporizadores vac√≠os
            const memorizationText = memorizationTime > 0 ? `${memorizationTime.toFixed(1)}s` : '(escribe tiempo)';
            const recallText = recallTime > 0 ? `${recallTime.toFixed(1)}s` : '(escribe tiempo)';
            document.getElementById('summary-timers').textContent = `${recallText}`;
            
            if (currentMode === 'memorization') {
                const modeText = memorizationTime > 0 ? `(${memorizationTime.toFixed(1)}s)` : '(escribe tiempo)';
                document.getElementById('summary-mode').textContent = `Modo: Tiempo de memorizaci√≥n ${modeText}`;
            } else {
                const autoAdvanceText = autoAdvanceTime > 0 ? `${autoAdvanceTime.toFixed(1)}s` : '(escribe tiempo)';
                const totalTime = pages * autoAdvanceTime;
                const totalText = totalTime > 0 ? `${totalTime.toFixed(1)}s` : '(calculando...)';
                document.getElementById('summary-mode').textContent = `Modo: Autoavance (${autoAdvanceText} por p√°gina, ${totalText} total)`;
            }
            
            // Calcular y actualizar tiempos estimados
            updateEstimatedTimes();
        }
        
        // Funci√≥n para convertir segundos a minutos y segundos
        function formatTimeToMinutesSeconds(seconds) {
            if (seconds < 60) {
                return `${seconds.toFixed(1)}s`;
            } else {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                if (remainingSeconds === 0) {
                    return `${minutes}m`;
                } else {
                    return `${minutes}m ${remainingSeconds.toFixed(1)}s`;
                }
            }
        }
        
        // Funci√≥n para actualizar tiempos estimados
        function updateEstimatedTimes() {
            let pages = selectedDigits;
            if (displayMode === 'pairs') {
                pages = Math.ceil(selectedDigits / 2);
            } else if (displayMode === 'triple') {
                pages = Math.ceil(selectedDigits / 3);
            }
            
            let timePerRound = 0;
            let totalTime = 0;
            let breakdown = '';
            
            if (currentMode === 'memorization') {
                if (memorizationTime > 0 && recallTime > 0) {
                    timePerRound = memorizationTime + recallTime;
                    totalTime = timePerRound * totalRounds;
                    breakdown = `Memorizaci√≥n: ${memorizationTime.toFixed(1)}s + Recall: ${recallTime.toFixed(1)}s`;
                } else {
                    timePerRound = 0;
                    totalTime = 0;
                    breakdown = 'Completa los tiempos de memorizaci√≥n y recall';
                }
            } else if (currentMode === 'auto-advance') {
                if (autoAdvanceTime > 0 && recallTime > 0) {
                    timePerRound = (autoAdvanceTime * pages) + recallTime;
                    totalTime = timePerRound * totalRounds;
                    breakdown = `Autoavance: ${autoAdvanceTime.toFixed(1)}s √ó ${pages} p√°ginas + Recall: ${recallTime.toFixed(1)}s`;
                } else {
                    timePerRound = 0;
                    totalTime = 0;
                    breakdown = 'Completa los tiempos de autoavance y recall';
                }
            }
            
            // Actualizar elementos del DOM
            const timePerRoundEl = document.getElementById('time-per-round');
            const timeTotalEl = document.getElementById('time-total');
            const timeBreakdownEl = document.getElementById('time-breakdown');
            
            if (timePerRoundEl) {
                timePerRoundEl.textContent = timePerRound > 0 ? formatTimeToMinutesSeconds(timePerRound) : 'Calculando...';
            }
            
            if (timeTotalEl) {
                timeTotalEl.textContent = totalTime > 0 ? formatTimeToMinutesSeconds(totalTime) : 'Calculando...';
            }
            
            if (timeBreakdownEl) {
                timeBreakdownEl.textContent = breakdown;
            }
        }

        // Funci√≥n para guardar controles especiales en localStorage
        function saveSpecialKeysToStorage() {
            try {
                localStorage.setItem('binaryGameSpecialKeys', JSON.stringify(specialKeys));
                showSaveConfirmation();
            } catch (e) {
                console.error('Error al guardar configuraci√≥n:', e);
            }
        }
        
        // Funci√≥n para cargar controles especiales desde localStorage
        function loadSpecialKeysFromStorage() {
            try {
                const saved = localStorage.getItem('binaryGameSpecialKeys');
                if (saved) {
                    const loaded = JSON.parse(saved);
                    // Validar que tiene todas las teclas necesarias
                    for (let i = 0; i <= 7; i++) {
                        const key = i.toString();
                        if (!loaded[key] || loaded[key].length !== 3 || !/^[01]{3}$/.test(loaded[key])) {
                            console.warn('Configuraci√≥n guardada inv√°lida, usando valores por defecto');
                            return {...defaultSpecialKeys};
                        }
                    }
                    return loaded;
                }
            } catch (e) {
                console.error('Error al cargar configuraci√≥n:', e);
            }
            return {...defaultSpecialKeys};
        }
        
        // Funci√≥n para restaurar valores por defecto
        function resetSpecialKeysToDefault() {
            if (confirm('¬øEst√°s seguro de que quieres restaurar los valores por defecto de los controles especiales?')) {
                specialKeys = {...defaultSpecialKeys};
                saveSpecialKeysToStorage();
                loadSpecialKeysConfig();
                updateControlsSummary();
                updateSpecialControlsInfo();
            }
        }
        
        // Funci√≥n para mostrar confirmaci√≥n de guardado
        function showSaveConfirmation() {
            const confirmationEl = document.getElementById('save-confirmation');
            if (confirmationEl) {
                confirmationEl.style.display = 'inline-block';
                setTimeout(() => {
                    confirmationEl.style.display = 'none';
                }, 2000);
            }
        }
        
        // Funci√≥n para cargar configuraci√≥n de controles especiales
        function loadSpecialKeysConfig() {
            for (let i = 0; i <= 7; i++) {
                const input = document.getElementById(`key-${i}`);
                if (input) {
                    input.value = specialKeys[i.toString()];
                    
                    // Event listener para filtrar solo d√≠gitos binarios mientras escribe
                    input.addEventListener('input', function() {
                        // Solo permitir 0 y 1, limitar a 3 caracteres
                        const filtered = this.value.replace(/[^01]/g, '').substring(0, 3);
                        this.value = filtered;
                    });
                    
                    // Event listener para validar y guardar cuando termina de editar
                    input.addEventListener('blur', function() {
                        let value = this.value.trim();
                        
                        // Si est√° vac√≠o o incompleto, rellenar con ceros a la derecha
                        if (value.length === 0) {
                            value = '000';
                        } else if (value.length < 3) {
                            value = value.padEnd(3, '0');
                        }
                        
                        this.value = value;
                        specialKeys[i.toString()] = value;
                        saveSpecialKeysToStorage();
                        updateControlsSummary();
                        updateSpecialControlsInfo();
                    });
                    
                    // Permitir seleccionar todo el texto al hacer clic
                    input.addEventListener('focus', function() {
                        this.select();
                    });
                }
            }
        }
        
        // Funci√≥n para actualizar resumen de controles
        function updateControlsSummary() {
            const controlsSummary = document.getElementById('summary-controls');
            if (controlsSummary) {
                const controlsList = Object.entries(specialKeys).map(([key, value]) => `Tecla ${key}: ${value}`).join(', ');
                controlsSummary.textContent = `Controles especiales: ${controlsList}`;
            }
        }
        
        // Funci√≥n para actualizar informaci√≥n de controles especiales en la fase de input
        function updateSpecialControlsInfo() {
            const controlsInfo = document.getElementById('special-controls-info');
            if (controlsInfo) {
                const controlsList = Object.entries(specialKeys).map(([key, value]) => `Tecla ${key}=${value}`).join(', ');
                controlsInfo.innerHTML = `
                    <strong>üéÆ Controles Especiales:</strong><br>
                    <span style="font-size: 0.8rem;">Teclas 0-7 rellenan 3 d√≠gitos autom√°ticamente</span><br>
                    <span style="font-size: 0.75rem; color: #666;">Configuraci√≥n: ${controlsList}</span>
                `;
            }
        }
        
                    // Inicializar resumen y descripci√≥n
            updateSummary();
            updateModeDescription();
            updateDisplayInfo();
            updateDirectionInfo();
        loadSpecialKeysConfig();
        updateControlsSummary();
        
        // Asegurar que el modo especial est√© desmarcado por defecto
        const specialMatrixCheckbox = document.getElementById('special-matrix-mode');
        if (specialMatrixCheckbox) {
            specialMatrixCheckbox.checked = false;
        }
        
        // Inicializar conversi√≥n de tiempo de recall
        const recallConversion = document.getElementById('recall-time-conversion');
        if (recallTime > 60) {
            recallConversion.textContent = `(${formatTimeDisplay(recallTime)})`;
            recallConversion.style.display = 'block';
        }
        
        // Inicializar conversi√≥n de tiempo de memorizaci√≥n
        const memorizationConversion = document.getElementById('memorization-time-conversion');
        if (memorizationTime > 60) {
            memorizationConversion.textContent = `(${formatTimeDisplay(memorizationTime)})`;
            memorizationConversion.style.display = 'block';
        }

                 // Iniciar juego
         function startGame() {
             // Validar que el campo de n√∫meros no est√© vac√≠o
             if (selectedDigits <= 0) {
                 alert('‚ùå Error: Por favor, escribe cu√°ntos n√∫meros binarios quieres memorizar antes de comenzar el juego.');
                 document.getElementById('digits-input').focus();
                 return;
             }
             
             // Validar que el campo de rondas no est√© vac√≠o
             if (totalRounds <= 0) {
                 alert('‚ùå Error: Por favor, escribe cu√°ntas rondas quieres jugar antes de comenzar el juego.');
                 document.getElementById('rounds-input').focus();
                 return;
             }
             
             // Validar que los campos de tiempo no est√©n vac√≠os
             if (currentMode === 'memorization') {
                 if (memorizationTime <= 0) {
                     alert('‚ùå Error: Por favor, escribe el tiempo de memorizaci√≥n antes de comenzar el juego.');
                     document.getElementById('memorization-timer').focus();
                     return;
                 }
             } else {
                 if (autoAdvanceTime <= 0) {
                     alert('‚ùå Error: Por favor, escribe el tiempo de autoavance antes de comenzar el juego.');
                     document.getElementById('auto-advance-time').focus();
                     return;
                 }
             }
             
             if (recallTime <= 0) {
                 alert('‚ùå Error: Por favor, escribe el tiempo de recall antes de comenzar el juego.');
                 document.getElementById('recall-timer').focus();
                 return;
             }
             
             // Validar configuraci√≥n de controles especiales
             for (let i = 0; i <= 7; i++) {
                 const keyValue = specialKeys[i.toString()];
                 if (!keyValue || keyValue.length !== 3 || !/^[01]{3}$/.test(keyValue)) {
                     alert(`‚ùå Error: La configuraci√≥n de la tecla ${i} debe contener exactamente 3 d√≠gitos binarios (0 y 1).`);
                     document.getElementById(`key-${i}`).focus();
                     return;
                 }
             }
             
             // Reiniciar variables de rondas al iniciar nuevo juego
             currentRound = 1;
             roundScores = [];
             totalScore = 0;
             
             // Obtener modo especial de matriz 3x6
             const specialMatrixCheckbox = document.getElementById('special-matrix-mode');
             if (specialMatrixCheckbox) {
                 specialMatrixMode = specialMatrixCheckbox.checked;
             }
             
             // Solo obtener modo de visualizaci√≥n y direcci√≥n si no est√° activo el modo especial
             if (!specialMatrixMode) {
                 // Obtener modo de visualizaci√≥n seleccionado
                 const singleGroupMode = document.getElementById('single-group-mode');
                 const pairsMode = document.getElementById('pairs-mode');
                 const tripleMode = document.getElementById('triple-mode');
                 
                 if (singleGroupMode && singleGroupMode.checked) {
                     displayMode = 'single';
                 } else if (pairsMode && pairsMode.checked) {
                     displayMode = 'pairs';
                 } else if (tripleMode && tripleMode.checked) {
                     displayMode = 'triple';
                 }
                 
                 // Obtener direcci√≥n seleccionada
                 const horizontalDirection = document.getElementById('horizontal-direction');
                 const verticalDirection = document.getElementById('vertical-direction');
                 
                 if (horizontalDirection && horizontalDirection.checked) {
                     direction = 'horizontal';
                 } else if (verticalDirection && verticalDirection.checked) {
                     direction = 'vertical';
                 }
             }
             
             generateNumberSequence();
             currentNumberIndex = 0;
             gameState = 'memorization';
             
                           // Usar tiempo seg√∫n el modo seleccionado
              if (currentMode === 'auto-advance') {
                  timer = autoAdvanceTime;
              } else {
                  timer = memorizationTime;
              }
              
              // Limpiar todos los campos antes de iniciar
              clearAllInputs();
              
              // Mostrar fase de preparaci√≥n antes de iniciar memorizaci√≥n
              document.getElementById('setup-phase').classList.add('hidden');
              const prepEl = document.getElementById('preparation-phase');
              const prepCountdownEl = document.getElementById('prep-countdown');
              if (prepEl && prepCountdownEl) {
                  prepEl.classList.remove('hidden');
                  let prepTime = 5;
                  prepCountdownEl.textContent = `${prepTime}`;
                  if (window.prepInterval) clearInterval(window.prepInterval);
                  window.prepInterval = setInterval(() => {
                      prepTime--;
                      prepCountdownEl.textContent = `${prepTime}`;
                      if (prepTime <= 0) {
                          clearInterval(window.prepInterval);
                          prepEl.classList.add('hidden');

                          document.getElementById('memorization-phase').classList.remove('hidden');
                          updateDisplay();
                          
                          // Actualizar timer inicial
                          document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                          
                          // Actualizar mensaje de memorizaci√≥n
                          const memorizationInfo = document.getElementById('memorization-info');
                          if (currentMode === 'auto-advance') {
                              let totalPages;
                              if (displayMode === 'single') {
                                  totalPages = numberSequence.length;
                              } else if (displayMode === 'pairs') {
                                  totalPages = Math.ceil(numberSequence.length / 2);
                              } else if (displayMode === 'triple') {
                                  totalPages = Math.ceil(numberSequence.length / 3);
                              }
                              memorizationInfo.textContent = `Ronda ${currentRound} - P√°gina 1 de ${totalPages}. Avanzar√° autom√°ticamente en ${autoAdvanceTime.toFixed(1)} segundos.`;
                          } else {
                              memorizationInfo.textContent = `Ronda ${currentRound} - Memoriza estos n√∫meros binarios. Tienes ${memorizationTime.toFixed(1)} segundos.`;
                          }
                          
                          // Configurar captura global de teclas para memorizaci√≥n
                          window.cleanupKeyCapture = setupGlobalKeyCapture();
                          
                          memorizationStartTime = Date.now();
                          startTimer();
                      }
                  }, 1000);
              } else {
                  // Fallback directo
                  document.getElementById('memorization-phase').classList.remove('hidden');
                  updateDisplay();
                  document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                  memorizationStartTime = Date.now();
                  startTimer();
              }
         }
        function updateDisplay() {
            console.log('=== FUNCI√ìN updateDisplay() EJECUTADA ===');
            
            const display = document.getElementById('number-display');
            const progress = document.getElementById('progress');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            console.log('Elementos encontrados:', {
                display: !!display,
                progress: !!progress,
                prevBtn: !!prevBtn,
                nextBtn: !!nextBtn
            });
            
            if (numberSequence.length === 0) {
                display.textContent = 'No hay n√∫meros para mostrar';
                return;
            }
            
            // Modo especial: Matriz 3x6
            if (specialMatrixMode) {
                const matrix = numberSequence[currentNumberIndex];
                const rows = matrix.split('\n');
                
                display.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; font-family: 'Courier New', monospace; font-size: 3rem; font-weight: bold; color: #333; gap: 15px;">
                        <div style="text-align: center; padding: 20px; background: transparent; border: none;">
                            ${rows.map(row => `<div style="margin-bottom: 10px; letter-spacing: 8px;">${row}</div>`).join('')}
                        </div>
                    </div>
                `;
                
                progress.textContent = `Matriz ${currentNumberIndex + 1} de ${numberSequence.length}`;
                
                prevBtn.disabled = currentNumberIndex === 0;
                nextBtn.disabled = currentNumberIndex + 1 >= numberSequence.length;
                
                // Aplicar estilo sin bordes en fase de memorizaci√≥n
                if (gameState === 'memorization') {
                    display.classList.add('memorization');
                } else {
                    display.classList.remove('memorization');
                }
                
                return;
            }
            
            let groupsToShow = [];
            let groupsInThisPage = 0;
            
            if (direction === 'horizontal') {
                // Modo horizontal (actual) - mostrar grupos por p√°ginas
                if (displayMode === 'single') {
                    // Modo individual: mostrar 1 grupo por p√°gina
                    groupsInThisPage = 1;
                } else if (displayMode === 'pairs') {
                    // Modo parejas: mostrar 2 grupos por p√°gina
                    if (currentNumberIndex + 2 >= numberSequence.length && numberSequence.length % 2 === 1) {
                        groupsInThisPage = 1;
                    } else {
                        groupsInThisPage = 2;
                    }
                } else if (displayMode === 'triple') {
                    // Modo triple: mostrar 3 grupos por p√°gina
                    if (currentNumberIndex + 3 >= numberSequence.length) {
                        groupsInThisPage = numberSequence.length - currentNumberIndex;
                    } else {
                        groupsInThisPage = 3;
                    }
                }
                
                // Obtener los grupos para mostrar
                for (let i = 0; i < groupsInThisPage && currentNumberIndex + i < numberSequence.length; i++) {
                    groupsToShow.push(numberSequence[currentNumberIndex + i]);
                }
                
                // Mostrar los grupos con formato horizontal con un peque√±o espacio entre grupos
                display.innerHTML = `
                    <div style="display: flex; justify-content: center; gap: 10px; font-family: 'Courier New', monospace; font-size: 3rem; font-weight: bold; color: #333; flex-wrap: wrap;">
                        ${groupsToShow.map(group => {
                            const [firstRow, secondRow] = group.split('\n');
                            return `
                                <div style="text-align: center; padding: 0px; background: transparent; border: none; min-width: auto;">
                                    <div style="margin-bottom: 10px; letter-spacing: 0px;">${firstRow}</div>
                                    <div style="letter-spacing: 0px;">${secondRow}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                progress.textContent = `Grupos ${currentNumberIndex + 1}-${currentNumberIndex + groupsInThisPage} de ${numberSequence.length}`;
                
                // Actualizar botones de navegaci√≥n para modo horizontal
                const prevShouldBeDisabled = currentNumberIndex === 0;
                const nextShouldBeDisabled = currentNumberIndex + groupsInThisPage >= numberSequence.length;
                
                prevBtn.disabled = prevShouldBeDisabled;
                nextBtn.disabled = nextShouldBeDisabled;
                
            } else {
                // Modo vertical (nuevo) - separar por p√°ginas seg√∫n la selecci√≥n
                if (displayMode === 'single') {
                    // Modo individual: mostrar 1 grupo por p√°gina
                    groupsInThisPage = 1;
                } else if (displayMode === 'pairs') {
                    // Modo parejas: mostrar 2 grupos por p√°gina
                    if (currentNumberIndex + 2 >= numberSequence.length && numberSequence.length % 2 === 1) {
                        groupsInThisPage = 1;
                    } else {
                        groupsInThisPage = 2;
                    }
                } else if (displayMode === 'triple') {
                    // Modo triple: mostrar 3 grupos por p√°gina
                    if (currentNumberIndex + 3 >= numberSequence.length) {
                        groupsInThisPage = numberSequence.length - currentNumberIndex;
                    } else {
                        groupsInThisPage = 3;
                    }
                }
                
                // Obtener los grupos para mostrar
                for (let i = 0; i < groupsInThisPage && currentNumberIndex + i < numberSequence.length; i++) {
                    groupsToShow.push(numberSequence[currentNumberIndex + i]);
                }
                
                // Mostrar los grupos en disposici√≥n vertical sin separaci√≥n visual
                display.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; font-family: 'Courier New', monospace; font-size: 2.5rem; font-weight: bold; color: #333; gap: 0px;">
                        ${groupsToShow.map(group => {
                            const [firstRow, secondRow] = group.split('\n');
                            return `
                                <div style="text-align: center; padding: 2px; background: transparent; border: none; min-width: 130px; margin: 0;">
                                    <div style="margin-bottom: 5px; letter-spacing: 2px;">${firstRow}</div>
                                    <div style="letter-spacing: 2px;">${secondRow}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                progress.textContent = `Grupos ${currentNumberIndex + 1}-${currentNumberIndex + groupsInThisPage} de ${numberSequence.length}`;
                
                // Actualizar botones de navegaci√≥n para modo vertical
                const prevShouldBeDisabled = currentNumberIndex === 0;
                const nextShouldBeDisabled = currentNumberIndex + groupsInThisPage >= numberSequence.length;
                
                prevBtn.disabled = prevShouldBeDisabled;
                nextBtn.disabled = nextShouldBeDisabled;
            }
            
            // Aplicar estilo sin bordes en fase de memorizaci√≥n
            if (gameState === 'memorization') {
                display.classList.add('memorization');
            } else {
                display.classList.remove('memorization');
            }
            
            console.log('Estado de botones:', {
                prevDisabled: prevBtn.disabled,
                nextDisabled: nextBtn.disabled,
                direction: direction,
                groupsInThisPage: groupsInThisPage
            });
        }

        // Navegaci√≥n
        function previousNumber() {
            console.log('=== FUNCI√ìN previousNumber() EJECUTADA ===');
            console.log('Bot√≥n Anterior clickeado. currentNumberIndex:', currentNumberIndex);
            console.log('numberSequence.length:', numberSequence.length);
            
            if (currentNumberIndex > 0) {
                // Modo especial: siempre avanzar de 1 en 1
                if (specialMatrixMode) {
                    currentNumberIndex--;
                    updateDisplay();
                    return;
                }
                
                // Retroceder seg√∫n el modo de visualizaci√≥n
                let stepSize = 1;
                if (displayMode === 'pairs') stepSize = 2;
                else if (displayMode === 'triple') stepSize = 3;
                
                currentNumberIndex = Math.max(0, currentNumberIndex - stepSize);
                console.log('Nuevo currentNumberIndex:', currentNumberIndex);
                updateDisplay();
                
                // Reiniciar timer si estamos en modo autoavance
                if (currentMode === 'auto-advance') {
                    clearInterval(timerInterval);
                    timer = autoAdvanceTime;
                    document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                    document.getElementById('elapsed-time').textContent = `Tiempo empleado: 0.0 segundos`;
                    startTimer();
                }
            } else {
                console.log('No se puede retroceder m√°s - ya estamos en el inicio');
            }
        }

        function nextNumber() {
            console.log('=== FUNCI√ìN nextNumber() EJECUTADA ===');
            console.log('Bot√≥n Siguiente clickeado. currentNumberIndex:', currentNumberIndex);
            console.log('numberSequence.length:', numberSequence.length);
            
            // Modo especial: siempre avanzar de 1 en 1
            if (specialMatrixMode) {
                if (currentNumberIndex + 1 < numberSequence.length) {
                    currentNumberIndex++;
                    updateDisplay();
                    
                    // Reiniciar timer si estamos en modo autoavance
                    if (currentMode === 'auto-advance') {
                        clearInterval(timerInterval);
                        timer = autoAdvanceTime;
                        document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                        document.getElementById('elapsed-time').textContent = `Tiempo empleado: 0.0 segundos`;
                        startTimer();
                    }
                }
                return;
            }
            
            // Calcular el paso seg√∫n el modo de visualizaci√≥n
            let stepSize = 1;
            if (displayMode === 'pairs') stepSize = 2;
            else if (displayMode === 'triple') stepSize = 3;
            
            const canAdvance = currentNumberIndex + stepSize < numberSequence.length;
            
            console.log('Puede avanzar:', canAdvance, 'stepSize:', stepSize);
            
            if (canAdvance) {
                currentNumberIndex += stepSize;
                console.log('Nuevo currentNumberIndex:', currentNumberIndex);
                updateDisplay();
                
                // Reiniciar timer si estamos en modo autoavance
                if (currentMode === 'auto-advance') {
                    clearInterval(timerInterval);
                    timer = autoAdvanceTime;
                    document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                    document.getElementById('elapsed-time').textContent = `Tiempo empleado: 0.0 segundos`;
                    startTimer();
                }
            } else {
                console.log('No se puede avanzar m√°s - ya estamos en el final');
            }
        }

        // Timer para fase de memorizaci√≥n
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            const startTime = Date.now();
            
            timerInterval = setInterval(() => {
                timer -= 0.1;
                const elapsedTime = ((Date.now() - startTime) / 1000).toFixed(1);
                
                if (timer <= 0) {
                    if (currentMode === 'auto-advance') {
                        // En modo autoavance, avanzar a la siguiente p√°gina
                        advanceToNextPage();
                    } else {
                        // En modo normal, terminar memorizaci√≥n
                        finishMemorization();
                    }
                } else {
                    document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                    document.getElementById('elapsed-time').textContent = `Tiempo empleado: ${elapsedTime} segundos`;
                }
            }, 100);
        }

        // Avanzar a la siguiente p√°gina en modo autoavance
        function advanceToNextPage() {
            
            let stepSize = 1;
            let totalPages = numberSequence.length;
            let currentPage = currentNumberIndex + 1;
            
            if (displayMode === 'pairs') {
                stepSize = 2;
                totalPages = Math.ceil(numberSequence.length / 2);
                currentPage = Math.floor(currentNumberIndex / 2) + 1;
            } else if (displayMode === 'triple') {
                stepSize = 3;
                totalPages = Math.ceil(numberSequence.length / 3);
                currentPage = Math.floor(currentNumberIndex / 3) + 1;
            }
            
            if (currentPage < totalPages) {
                // Avanzar a la siguiente p√°gina
                currentNumberIndex += stepSize;
                updateDisplay();
                
                // Reiniciar timer para la nueva p√°gina
                timer = autoAdvanceTime;
                document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                document.getElementById('elapsed-time').textContent = `Tiempo empleado: 0.0 segundos`;
                
                // Actualizar mensaje de progreso
                const memorizationInfo = document.getElementById('memorization-info');
                memorizationInfo.textContent = `P√°gina ${currentPage + 1} de ${totalPages}. Avanzar√° autom√°ticamente en ${autoAdvanceTime.toFixed(1)} segundos.`;
            } else {
                // Llegamos a la √∫ltima p√°gina, terminar memorizaci√≥n
                finishMemorization();
            }
        }

        // Terminar memorizaci√≥n manualmente
        function finishMemorization() {
            clearInterval(timerInterval);
            // Calcular tiempo real de memorizaci√≥n
            actualMemorizationTime = ((Date.now() - memorizationStartTime) / 1000).toFixed(1);
            
            gameState = 'input';
            document.getElementById('memorization-phase').classList.add('hidden');
            document.getElementById('input-phase').classList.remove('hidden');
            
            // Limpiar todos los campos antes de generar la cuadr√≠cula
            clearAllInputs();
            
            // Reiniciar √≠ndice de p√°gina para la fase de escritura
            currentInputPage = 0;
            
            // Generar cuadr√≠cula de d√≠gitos mostrando TODOS los grupos (sin paginaci√≥n en recall)
            console.log(`‚úÖ finishMemorization: Generando inputs para todos los ${numberSequence.length} grupos`);
            generateDigitsGrid();
            
            // Actualizar informaci√≥n de controles especiales
            updateSpecialControlsInfo();
            
            // Agregar event listener para el input continuo
            const continuousInput = document.getElementById('continuous-input');
            if (continuousInput) {
                continuousInput.addEventListener('input', syncDigitsGrid);
            }
            
            // Configurar captura global de teclas
            window.cleanupKeyCapture = setupGlobalKeyCapture();
            
            // Iniciar timer de recall
            startRecallTimer();
            
            // 1. En finishMemorization, despu√©s de mostrar la fase de input, a√±ade:
            document.getElementById('recall-timer-display').insertAdjacentHTML('afterend', `<div id="memorization-time-info" style="font-size:1.1rem;color:#1976d2;margin:10px 0 0 0;">Tiempo de memorizaci√≥n: <b>${actualMemorizationTime}</b> segundos</div>`);
            
            // En finishMemorization, despu√©s de calcular actualMemorizationTime, guardar inmediatamente en el array:
            actualMemorizationTime = ((Date.now() - memorizationStartTime) / 1000).toFixed(1);
            // Guardar el tiempo de memorizaci√≥n para la ronda actual inmediatamente
            if (!window.roundMemTimes) window.roundMemTimes = [];
            // Asegurar que el array tenga el tama√±o correcto
            while (window.roundMemTimes.length < currentRound) {
                window.roundMemTimes.push(null);
            }
            window.roundMemTimes[currentRound - 1] = actualMemorizationTime;
            // Actualizar la progresi√≥n de rondas para mostrar el tiempo de la ronda actual
            updateProgressDisplay();
        }

        // Generar cuadr√≠cula de d√≠gitos para n√∫meros binarios
        function generateDigitsGrid() {
            console.log(`‚úÖ generateDigitsGrid llamada - gameState: ${gameState}, displayMode: ${displayMode}`);
            const container = document.getElementById('digits-input-container');
            container.innerHTML = '';
            
            // En fase de recall (input), SIEMPRE mostrar todos los inputs sin paginaci√≥n
            if (gameState === 'input') {
                console.log(`‚úÖ Fase de recall: Mostrando TODOS los inputs (${numberSequence.length} grupos)`);
                // En fase de recall, ignorar displayMode y mostrar todos los grupos
                if (specialMatrixMode) {
                    // NUEVA IMPLEMENTACI√ìN PARA MODO ESPECIAL EN RECALL
                    console.log(`‚≠ê Creando fase de recall para modo especial - ${numberSequence.length} matrices`);
                    
                    // Configurar contenedor principal
                    container.style.display = 'flex';
                    container.style.flexDirection = 'column';
                    container.style.gap = '25px';
                    container.style.maxWidth = '1200px';
                    container.style.margin = '20px auto';
                    container.style.padding = '20px';
                    
                    // Crear encabezado informativo
                    const header = document.createElement('div');
                    header.style.cssText = `
                        text-align: center; 
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                        color: white; 
                        padding: 15px; 
                        border-radius: 10px; 
                        margin-bottom: 10px;
                        font-weight: bold;
                        font-size: 1.1rem;
                    `;
                    header.innerHTML = `
                        ‚≠ê Modo Especial: Matriz 3√ó6<br>
                        <span style="font-size: 0.9rem; opacity: 0.9;">Escribe en TODOS los cuadros de TODAS las matrices</span>
                    `;
                    container.appendChild(header);
                    
                    // Crear inputs para cada matriz
                    for (let matrixIndex = 0; matrixIndex < numberSequence.length; matrixIndex++) {
                        const matrixContainer = document.createElement('div');
                        matrixContainer.style.cssText = `
                            background: linear-gradient(145deg, #f8f9fa 0%, #e9ecef 100%);
                            border: 3px solid #667eea;
                            border-radius: 15px;
                            padding: 25px;
                            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
                            transition: all 0.3s ease;
                        `;
                        
                        // T√≠tulo de la matriz con estilo mejorado
                        const title = document.createElement('div');
                        title.textContent = `Matriz ${matrixIndex + 1}`;
                        title.style.cssText = `
                            text-align: center; 
                            font-weight: bold; 
                            font-size: 1.4rem; 
                            color: #667eea; 
                            margin-bottom: 20px;
                            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
                        `;
                        matrixContainer.appendChild(title);
                        
                        // Crear 3 filas de 6 d√≠gitos con mejor espaciado
                        for (let rowNum = 0; rowNum < 3; rowNum++) {
                            const row = document.createElement('div');
                            row.style.cssText = `
                                display: flex; 
                                gap: 8px; 
                                justify-content: center; 
                                margin-bottom: ${rowNum < 2 ? '12px' : '0'};
                                align-items: center;
                            `;
                            
                            // Etiqueta de fila (opcional, para mejor UX)
                            const rowLabel = document.createElement('div');
                            rowLabel.textContent = `F${rowNum + 1}:`;
                            rowLabel.style.cssText = `
                                font-weight: bold; 
                                color: #667eea; 
                                margin-right: 10px; 
                                font-size: 0.9rem;
                                min-width: 30px;
                            `;
                            row.appendChild(rowLabel);
                            
                            for (let colNum = 0; colNum < 6; colNum++) {
                                const digitPos = rowNum * 6 + colNum;
                                
                                // Crear input manualmente para evitar conflictos con createDigitInput
                                const input = document.createElement('input');
                                input.type = 'text';
                                input.className = 'digit-input';
                                input.maxLength = 1;
                                // IMPORTANTE: Usar 18 d√≠gitos por matriz en lugar de 6 por grupo
                                input.dataset.digitIndex = (matrixIndex * 18) + digitPos;
                                input.dataset.groupIndex = matrixIndex;
                                input.dataset.digitPosition = digitPos;
                                input.placeholder = '_';
                                input.value = '';
                                
                                input.style.cssText = `
                                    width: 45px; 
                                    height: 45px; 
                                    font-size: 1.6rem; 
                                    text-align: center; 
                                    border: 2px solid #667eea; 
                                    border-radius: 8px; 
                                    font-family: 'Courier New', monospace; 
                                    font-weight: bold;
                                    background: white;
                                    transition: all 0.2s ease;
                                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                                `;
                                
                                // Agregar event listeners manualmente (copiados de createDigitInput)
                                input.addEventListener('input', function(e) {
                                    const value = e.target.value;
                                    if (value.length > 0 && !/^[01]$/.test(value)) {
                                        e.target.value = '';
                                        // Mostrar mensaje de error temporal
                                        e.target.style.borderColor = '#dc3545';
                                        e.target.style.backgroundColor = '#f8d7da';
                                        setTimeout(() => {
                                            e.target.style.borderColor = '#667eea';
                                            e.target.style.backgroundColor = 'white';
                                        }, 1000);
                                        return;
                                    }
                                    if (value.length > 1) {
                                        e.target.value = value.slice(-1);
                                    }
                                    syncContinuousInput();
                                });
                                
                                // Evento para mover al siguiente input autom√°ticamente
                                input.addEventListener('input', function(e) {
                                    const value = e.target.value;
                                    if (value.length === 1 && /^[01]$/.test(value)) {
                                        const nextInput = document.querySelector(`[data-digit-index="${(matrixIndex * 18) + digitPos + 1}"]`);
                                        if (nextInput) {
                                            nextInput.focus();
                                        }
                                    }
                                });
                                
                                // Evento para permitir clic directo en cualquier d√≠gito
                                input.addEventListener('click', function(e) {
                                    e.stopPropagation();
                                    console.log(`üñ±Ô∏è Click en input - Matriz: ${matrixIndex}, Posici√≥n: ${digitPos}, √çndice total: ${(matrixIndex * 18) + digitPos}`);
                                    this.focus();
                                    this.select();
                                });
                                
                                // Efectos hover y focus mejorados
                                input.addEventListener('mouseenter', function() {
                                    this.style.borderColor = '#5a67d8';
                                    this.style.backgroundColor = '#f7fafc';
                                    this.style.transform = 'scale(1.05)';
                                });
                                
                                input.addEventListener('mouseleave', function() {
                                    this.style.borderColor = '#667eea';
                                    this.style.backgroundColor = 'white';
                                    this.style.transform = 'scale(1)';
                                });
                                
                                input.addEventListener('focus', function() {
                                    this.style.borderColor = '#4c51bf';
                                    this.style.backgroundColor = '#ebf4ff';
                                    this.style.boxShadow = '0 0 0 3px rgba(79, 172, 254, 0.3)';
                                });
                                
                                input.addEventListener('blur', function() {
                                    this.style.borderColor = '#667eea';
                                    this.style.backgroundColor = 'white';
                                    this.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
                                });
                                
                                row.appendChild(input);
                            }
                            
                            matrixContainer.appendChild(row);
                        }
                        
                        // Agregar indicador visual de que esta matriz es editable
                        const editIndicator = document.createElement('div');
                        editIndicator.style.cssText = `
                            text-align: center; 
                            margin-top: 15px; 
                            font-size: 0.8rem; 
                            color: #667eea; 
                            font-style: italic;
                        `;
                        editIndicator.innerHTML = '‚úèÔ∏è Haz clic en cualquier cuadro para escribir';
                        matrixContainer.appendChild(editIndicator);
                        
                        container.appendChild(matrixContainer);
                    }
                    
                    // Agregar footer informativo
                    const footer = document.createElement('div');
                    footer.style.cssText = `
                        text-align: center; 
                        background: #e3f2fd; 
                        border: 2px solid #bbdefb; 
                        border-radius: 10px; 
                        padding: 15px; 
                        margin-top: 10px;
                        font-size: 0.9rem;
                        color: #1976d2;
                    `;
                    footer.innerHTML = `
                        üí° <strong>Consejos:</strong> Puedes escribir directamente con el teclado o hacer clic en cualquier cuadro.<br>
                        Usa las teclas 0-7 para rellenar autom√°ticamente 3 d√≠gitos con los valores configurados.
                    `;
                    container.appendChild(footer);
                    
                    console.log(`‚úÖ Modo especial: Creados inputs para ${numberSequence.length} matrices (${numberSequence.length * 18} cuadros total)`);
                    return;
                    
                } else {
                    // Modo normal en fase de recall: mostrar todos los grupos sin paginaci√≥n
                    console.log(`‚úÖ Modo normal en recall: Mostrando ${numberSequence.length} grupos`);
                    // Usar la l√≥gica existente pero sin paginaci√≥n
                }
            }
            
            // Configurar el contenedor seg√∫n la direcci√≥n y modo de visualizaci√≥n
            container.style.display = 'grid';
            
            let columns, maxWidth;
            if (direction === 'vertical') {
                // En modo vertical, siempre 3 columnas (para los 3 d√≠gitos de cada grupo)
                columns = 3;
                maxWidth = '800px';
            } else {
                // En modo horizontal, usar la l√≥gica original
                columns = displayMode === 'triple' ? 6 : 4;
                maxWidth = displayMode === 'triple' ? '1400px' : '1200px';
            }
            
            container.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
            container.style.gap = '2px';
            container.style.maxWidth = maxWidth;
            container.style.margin = '20px auto';
            
            // Aplicar clase seg√∫n el modo de visualizaci√≥n
            if (displayMode === 'triple') {
                container.classList.add('triple-mode');
            } else {
                container.classList.remove('triple-mode');
            }
            
            // Crear inputs para todos los grupos en la secuencia
            if (direction === 'vertical') {
                // En modo vertical, organizar todos los inputs en columnas por p√°gina de memorizaci√≥n
                // Calcular cu√°ntos grupos por p√°gina seg√∫n el modo de visualizaci√≥n
                let groupsPerPage = 1;
                if (displayMode === 'pairs') groupsPerPage = 2;
                else if (displayMode === 'triple') groupsPerPage = 3;
                
                // Calcular cu√°ntas p√°ginas de memorizaci√≥n hay
                const totalMemorizationPages = Math.ceil(numberSequence.length / groupsPerPage);
                
                // Crear contenedor principal con grid para las columnas
                const mainContainer = document.createElement('div');
                mainContainer.style.cssText = 'display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0px; width: 100%; max-width: 700px; margin: 0 auto;';
                
                // Crear una columna para cada p√°gina de memorizaci√≥n
                for (let pageNum = 0; pageNum < totalMemorizationPages; pageNum++) {
                    const pageColumn = document.createElement('div');
                    // Agregar borde solo si no es la √∫ltima columna
                    const borderStyle = pageNum < totalMemorizationPages - 1 ? 'border-right: 2px solid #e9ecef;' : '';
                    pageColumn.style.cssText = `display: flex; flex-direction: column; align-items: center; gap: 0px; padding: 15px 0; ${borderStyle}`;
                    
                    // Sin t√≠tulo de p√°gina para la fase de escritura
                    
                    // Calcular qu√© grupos pertenecen a esta p√°gina
                    const startGroupForPage = pageNum * groupsPerPage;
                    const endGroupForPage = Math.min(startGroupForPage + groupsPerPage, numberSequence.length);
                    
                    // Crear inputs para los grupos de esta p√°gina
                    for (let groupIndex = startGroupForPage; groupIndex < endGroupForPage; groupIndex++) {
                        // Crear contenedor para el grupo de d√≠gitos
                        const groupContainer = document.createElement('div');
                        groupContainer.style.cssText = 'text-align: center; padding: 2px; background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 4px; min-width: 120px; font-family: Courier New, monospace;';
                        
                        // Crear contenedor para la primera fila (3 d√≠gitos)
                        const firstRow = document.createElement('div');
                        firstRow.style.cssText = 'display: flex; gap: 0px; justify-content: center; margin-bottom: 5px;';
                        
                        // Crear contenedor para la segunda fila (3 d√≠gitos)
                        const secondRow = document.createElement('div');
                        secondRow.style.cssText = 'display: flex; gap: 0px; justify-content: center;';
                        
                        // Crear inputs para la primera fila (posiciones 0, 1, 2)
                        for (let digitPos = 0; digitPos < 3; digitPos++) {
                            const input = createDigitInput(groupIndex, digitPos);
                            input.style.cssText = 'width: 25px; height: 25px; font-size: 1rem; text-align: center; border: 1px solid #ddd; border-radius: 3px; font-family: Courier New, monospace; font-weight: bold;';
                            firstRow.appendChild(input);
                        }
                        
                        // Crear inputs para la segunda fila (posiciones 3, 4, 5)
                        for (let digitPos = 3; digitPos < 6; digitPos++) {
                            const input = createDigitInput(groupIndex, digitPos);
                            input.style.cssText = 'width: 25px; height: 25px; font-size: 1rem; text-align: center; border: 1px solid #ddd; border-radius: 3px; font-family: Courier New, monospace; font-weight: bold;';
                            secondRow.appendChild(input);
                        }
                        
                        groupContainer.appendChild(firstRow);
                        groupContainer.appendChild(secondRow);
                        pageColumn.appendChild(groupContainer);
                    }
                    
                    mainContainer.appendChild(pageColumn);
                }
                
                container.appendChild(mainContainer);
            } else {
                // Modo horizontal - usar flexbox en lugar de grid para evitar apilamiento
                container.style.display = 'flex';
                container.style.flexDirection = 'row';
                container.style.justifyContent = 'center';
                container.style.alignItems = 'flex-start';
                container.style.gap = '20px';
                container.style.flexWrap = 'wrap';
                
                for (let groupIndex = 0; groupIndex < numberSequence.length; groupIndex++) {
                    // Crear contenedor para el grupo de d√≠gitos
                    const groupContainer = document.createElement('div');
                    groupContainer.className = 'number-pair';
                    groupContainer.style.display = 'flex';
                    groupContainer.style.flexDirection = 'column';
                    groupContainer.style.alignItems = 'center';
                    groupContainer.style.gap = '2px';
                    groupContainer.style.padding = '4px';
                    groupContainer.style.background = '#f8f9fa';
                    groupContainer.style.border = '2px solid #e9ecef';
                    groupContainer.style.borderRadius = '8px';
                    groupContainer.style.minWidth = '100px';
                    
                    // Crear contenedor para la primera fila (3 d√≠gitos)
                    const firstRow = document.createElement('div');
                    firstRow.style.display = 'flex';
                    firstRow.style.gap = '1px';
                    firstRow.style.justifyContent = 'center';
                    
                    // Crear contenedor para la segunda fila (3 d√≠gitos)
                    const secondRow = document.createElement('div');
                    secondRow.style.display = 'flex';
                    secondRow.style.gap = '1px';
                    secondRow.style.justifyContent = 'center';
                    
                    // Crear inputs para la primera fila (posiciones 0, 1, 2)
                    for (let digitPos = 0; digitPos < 3; digitPos++) {
                        const input = createDigitInput(groupIndex, digitPos);
                        firstRow.appendChild(input);
                    }
                    
                    // Crear inputs para la segunda fila (posiciones 3, 4, 5)
                    for (let digitPos = 3; digitPos < 6; digitPos++) {
                        const input = createDigitInput(groupIndex, digitPos);
                        secondRow.appendChild(input);
                    }
                    
                    groupContainer.appendChild(firstRow);
                    groupContainer.appendChild(secondRow);
                    container.appendChild(groupContainer);
                }
            }
            
            // Limpiar tambi√©n el input continuo
            const continuousInput = document.getElementById('continuous-input');
            if (continuousInput) {
                continuousInput.value = '';
                continuousInput.placeholder = 'Escribe todos los n√∫meros binarios seguidos aqu√≠...';
            }
            
            // Asegurar que todos los campos est√©n completamente vac√≠os
            setTimeout(() => {
                const allInputs = container.querySelectorAll('.digit-input');
                console.log(`‚úÖ Total de inputs generados: ${allInputs.length}`);
                console.log(`‚úÖ N√∫mero de grupos: ${numberSequence.length}`);
                console.log(`‚úÖ D√≠gitos esperados: ${specialMatrixMode ? numberSequence.length * 18 : numberSequence.length * 6}`);
                allInputs.forEach(input => {
                    input.value = '';
                });
            }, 10);
        }
        
        // Generar cuadr√≠cula de d√≠gitos para una p√°gina espec√≠fica
        function generateDigitsGridForPage(pageIndex) {
            console.log(`‚ö†Ô∏è generateDigitsGridForPage llamada con p√°gina: ${pageIndex}`);
            console.trace(); // Mostrar stack trace
            const container = document.getElementById('digits-input-container');
            container.innerHTML = '';
            
            // En modo especial, siempre mostrar todas las matrices (no paginar)
            if (specialMatrixMode) {
                // Simplemente llamar a generateDigitsGrid que ya maneja el modo especial
                generateDigitsGrid();
                return;
            }
            
            // Calcular cu√°ntos grupos mostrar en esta p√°gina seg√∫n el modo
            let groupsInThisPage = 0;
            let startGroupIndex = 0;
            
            if (displayMode === 'single') {
                // Modo individual: mostrar 1 grupo por p√°gina
                groupsInThisPage = 1;
                startGroupIndex = pageIndex;
            } else if (displayMode === 'pairs') {
                // Modo parejas: mostrar 2 grupos por p√°gina
                startGroupIndex = pageIndex * 2;
                if (startGroupIndex + 2 >= numberSequence.length && numberSequence.length % 2 === 1) {
                    groupsInThisPage = 1;
                } else {
                    groupsInThisPage = 2;
                }
            } else if (displayMode === 'triple') {
                // Modo triple: mostrar 3 grupos por p√°gina
                startGroupIndex = pageIndex * 3;
                if (startGroupIndex + 3 >= numberSequence.length) {
                    groupsInThisPage = numberSequence.length - startGroupIndex;
                } else {
                    groupsInThisPage = 3;
                }
            }
            
            // Configurar el contenedor seg√∫n la direcci√≥n y modo de visualizaci√≥n
            container.style.display = 'grid';
            
            let columns, maxWidth;
            if (direction === 'vertical') {
                // En modo vertical, siempre 3 columnas (para los 3 d√≠gitos de cada grupo)
                columns = 3;
                maxWidth = '800px';
            } else {
                // En modo horizontal, usar la l√≥gica original
                columns = displayMode === 'triple' ? 6 : 4;
                maxWidth = displayMode === 'triple' ? '1400px' : '1200px';
            }
            
            container.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
            container.style.gap = '2px';
            container.style.maxWidth = maxWidth;
            container.style.margin = '20px auto';
            
            // Aplicar clase seg√∫n el modo de visualizaci√≥n
            if (displayMode === 'triple') {
                container.classList.add('triple-mode');
            } else {
                container.classList.remove('triple-mode');
            }
            
            // Crear inputs solo para los grupos de esta p√°gina
            if (direction === 'vertical') {
                // En modo vertical, organizar todos los inputs en columnas por p√°gina de memorizaci√≥n
                // Calcular cu√°ntas p√°ginas de memorizaci√≥n hay
                const totalMemorizationPages = Math.ceil(numberSequence.length / groupsInThisPage);
                
                // Crear contenedor principal con grid para las columnas
                const mainContainer = document.createElement('div');
                mainContainer.style.cssText = 'display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0px; width: 100%; max-width: 700px; margin: 0 auto;';
                
                // Crear una columna para cada p√°gina de memorizaci√≥n
                for (let pageNum = 0; pageNum < totalMemorizationPages; pageNum++) {
                    const pageColumn = document.createElement('div');
                    // Agregar borde solo si no es la √∫ltima columna
                    const borderStyle = pageNum < totalMemorizationPages - 1 ? 'border-right: 2px solid #e9ecef;' : '';
                    pageColumn.style.cssText = `display: flex; flex-direction: column; align-items: center; gap: 0px; padding: 15px 0; ${borderStyle}`;
                    
                    // Sin t√≠tulo de p√°gina para la fase de escritura
                    
                    // Calcular qu√© grupos pertenecen a esta p√°gina
                    const startGroupForPage = pageNum * groupsInThisPage;
                    const endGroupForPage = Math.min(startGroupForPage + groupsInThisPage, numberSequence.length);
                    
                    // Crear inputs para los grupos de esta p√°gina
                    for (let groupIndex = startGroupForPage; groupIndex < endGroupForPage; groupIndex++) {
                        // Crear contenedor para el grupo de d√≠gitos
                        const groupContainer = document.createElement('div');
                        groupContainer.style.cssText = 'text-align: center; padding: 2px; background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 4px; min-width: 120px; font-family: Courier New, monospace;';
                        
                        // Crear contenedor para la primera fila (3 d√≠gitos)
                        const firstRow = document.createElement('div');
                        firstRow.style.cssText = 'display: flex; gap: 0px; justify-content: center; margin-bottom: 5px;';
                        
                        // Crear contenedor para la segunda fila (3 d√≠gitos)
                        const secondRow = document.createElement('div');
                        secondRow.style.cssText = 'display: flex; gap: 0px; justify-content: center;';
                        
                        // Crear inputs para la primera fila (posiciones 0, 1, 2)
                        for (let digitPos = 0; digitPos < 3; digitPos++) {
                            const input = createDigitInput(groupIndex, digitPos);
                            input.style.cssText = 'width: 25px; height: 25px; font-size: 1rem; text-align: center; border: 1px solid #ddd; border-radius: 3px; font-family: Courier New, monospace; font-weight: bold;';
                            firstRow.appendChild(input);
                        }
                        
                        // Crear inputs para la segunda fila (posiciones 3, 4, 5)
                        for (let digitPos = 3; digitPos < 6; digitPos++) {
                            const input = createDigitInput(groupIndex, digitPos);
                            input.style.cssText = 'width: 25px; height: 25px; font-size: 1rem; text-align: center; border: 1px solid #ddd; border-radius: 3px; font-family: Courier New, monospace; font-weight: bold;';
                            secondRow.appendChild(input);
                        }
                        
                        groupContainer.appendChild(firstRow);
                        groupContainer.appendChild(secondRow);
                        pageColumn.appendChild(groupContainer);
                    }
                    
                    mainContainer.appendChild(pageColumn);
                }
                
                container.appendChild(mainContainer);
            } else {
                // Modo horizontal - usar flexbox en lugar de grid para evitar apilamiento
                container.style.display = 'flex';
                container.style.flexDirection = 'row';
                container.style.justifyContent = 'center';
                container.style.alignItems = 'flex-start';
                container.style.gap = '20px';
                container.style.flexWrap = 'wrap';
                
                for (let i = 0; i < groupsInThisPage && startGroupIndex + i < numberSequence.length; i++) {
                    const groupIndex = startGroupIndex + i;
                    
                    // Crear contenedor para el grupo de d√≠gitos
                    const groupContainer = document.createElement('div');
                    groupContainer.className = 'number-pair';
                    groupContainer.style.display = 'flex';
                    groupContainer.style.flexDirection = 'column';
                    groupContainer.style.alignItems = 'center';
                    groupContainer.style.gap = '8px';
                    groupContainer.style.padding = '15px';
                    groupContainer.style.background = '#f8f9fa';
                    groupContainer.style.border = '2px solid #e9ecef';
                    groupContainer.style.borderRadius = '8px';
                    groupContainer.style.minWidth = '100px';
                    
                    // Crear contenedor para la primera fila (3 d√≠gitos)
                    const firstRow = document.createElement('div');
                    firstRow.style.display = 'flex';
                    firstRow.style.gap = '5px';
                    firstRow.style.justifyContent = 'center';
                    
                    // Crear contenedor para la segunda fila (3 d√≠gitos)
                    const secondRow = document.createElement('div');
                    secondRow.style.display = 'flex';
                    secondRow.style.gap = '5px';
                    secondRow.style.justifyContent = 'center';
                    
                    // Crear inputs para la primera fila (posiciones 0, 1, 2)
                    for (let digitPos = 0; digitPos < 3; digitPos++) {
                        const input = createDigitInput(groupIndex, digitPos);
                        firstRow.appendChild(input);
                    }
                    
                    // Crear inputs para la segunda fila (posiciones 3, 4, 5)
                    for (let digitPos = 3; digitPos < 6; digitPos++) {
                        const input = createDigitInput(groupIndex, digitPos);
                        secondRow.appendChild(input);
                    }
                    
                    groupContainer.appendChild(firstRow);
                    groupContainer.appendChild(secondRow);
                    container.appendChild(groupContainer);
                }
            }
            
            // Limpiar tambi√©n el input continuo
            const continuousInput = document.getElementById('continuous-input');
            if (continuousInput) {
                continuousInput.value = '';
                continuousInput.placeholder = 'Escribe todos los n√∫meros binarios seguidos aqu√≠...';
            }
            
            // Asegurar que todos los campos est√©n completamente vac√≠os
            setTimeout(() => {
                const allInputs = container.querySelectorAll('.digit-input');
                allInputs.forEach(input => {
                    input.value = '';
                });
            }, 10);
            
            // Actualizar informaci√≥n de p√°gina
            updateInputPageInfo();
        }
        
        // Actualizar informaci√≥n de p√°gina en la fase de escritura
        function updateInputPageInfo() {
            const pageInfo = document.getElementById('input-page-info');
            if (pageInfo) {
                // Mostrar texto simple indicando que deben escribir todos los n√∫meros
                pageInfo.textContent = `Escribe todos los n√∫meros binarios memorizados (${numberSequence.length} grupos)`;
            }
        }
        
        // Navegaci√≥n en la fase de escritura
        function previousInputPage() {
            console.log(`‚ö†Ô∏è previousInputPage llamada - currentInputPage: ${currentInputPage}`);
            // En modo especial, no hay paginaci√≥n
            if (specialMatrixMode) {
                return;
            }
            
            if (currentInputPage > 0) {
                currentInputPage--;
                generateDigitsGridForPage(currentInputPage);
            }
        }
        
        function nextInputPage() {
            console.log(`‚ö†Ô∏è nextInputPage llamada - currentInputPage: ${currentInputPage}`);
            // En modo especial, no hay paginaci√≥n
            if (specialMatrixMode) {
                return;
            }
            
            let totalPages;
            if (displayMode === 'single') {
                totalPages = numberSequence.length;
            } else if (displayMode === 'pairs') {
                totalPages = Math.ceil(numberSequence.length / 2);
            } else if (displayMode === 'triple') {
                totalPages = Math.ceil(numberSequence.length / 3);
            }
            
            if (currentInputPage < totalPages - 1) {
                currentInputPage++;
                generateDigitsGridForPage(currentInputPage);
            }
        }
        
        // Funci√≥n auxiliar para crear inputs de d√≠gitos
        function createDigitInput(groupIndex, digitPos) {
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'digit-input';
            input.maxLength = 1;
            input.dataset.digitIndex = (groupIndex * 6) + digitPos;
            input.dataset.groupIndex = groupIndex;
            input.dataset.digitPosition = digitPos;
            input.placeholder = '_';
            input.value = '';
            input.style.width = '30px';
            input.style.height = '30px';
            input.style.fontSize = '1.2rem';
            input.style.fontWeight = 'bold';
            input.style.textAlign = 'center';
            input.style.border = '2px solid #ddd';
            input.style.borderRadius = '6px';
            input.style.fontFamily = "'Courier New', monospace";
            
            // Validar que solo se ingresen 0 y 1
            input.addEventListener('input', function(e) {
                const value = e.target.value;
                if (value.length > 0 && !/^[01]$/.test(value)) {
                    e.target.value = '';
                    // Mostrar mensaje de error temporal
                    e.target.style.borderColor = '#dc3545';
                    e.target.style.backgroundColor = '#f8d7da';
                    setTimeout(() => {
                        e.target.style.borderColor = '';
                        e.target.style.backgroundColor = '';
                    }, 1000);
                    return;
                }
                if (value.length > 1) {
                    e.target.value = value.slice(-1);
                }
                syncContinuousInput();
            });
            
            // Evento para mover al siguiente input autom√°ticamente
            input.addEventListener('input', function(e) {
                const value = e.target.value;
                if (value.length === 1 && /^[01]$/.test(value)) {
                    const nextInput = document.querySelector(`[data-digit-index="${(groupIndex * 6) + digitPos + 1}"]`);
                    if (nextInput) {
                        nextInput.focus();
                    }
                }
            });
            
            // Evento para permitir clic directo en cualquier d√≠gito
            input.addEventListener('click', function(e) {
                e.stopPropagation();
                console.log(`üñ±Ô∏è Click en input - Grupo: ${this.dataset.groupIndex}, Posici√≥n: ${this.dataset.digitPosition}, √çndice total: ${this.dataset.digitIndex}`);
                this.focus();
                this.select();
            });
            
            return input;
        }

        // Configurar captura global de teclas
        function setupGlobalKeyCapture() {
            const totalDigits = specialMatrixMode ? numberSequence.length * 18 : numberSequence.length * 6; // 18 d√≠gitos por matriz o 6 por grupo
            let currentDigitIndex = 0;
            
            function handleKeyPress(e) {
                // Alternar pantalla completa con F11
                if (e.key === 'F11') {
                    e.preventDefault();
                    toggleFullscreen();
                    return;
                }
                
                // Procesar si estamos en la fase de memorizaci√≥n o recall
                if (gameState !== 'memorization' && gameState !== 'input') return;
                
                // Navegaci√≥n en fase de memorizaci√≥n
                if (gameState === 'memorization') {
                    if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        previousNumber();
                        return;
                    }
                    if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        nextNumber();
                        return;
                    }
                    return; // No procesar otras teclas en memorizaci√≥n
                }
                
                // Fase de recall - verificar si alg√∫n input de d√≠gito tiene el foco (edici√≥n directa)
                const focusedDigitInput = document.querySelector('.digit-input:focus');
                const focusedContinuousInput = document.querySelector('#continuous-input:focus');
                
                // Si el input continuo tiene foco, no procesar globalmente
                if (focusedContinuousInput) {
                    return;
                }
                
                // Procesar controles especiales (teclas 0-7) para rellenar 3 d√≠gitos PRIMERO
                if (specialKeys[e.key]) {
                    e.preventDefault();
                    const binaryValue = specialKeys[e.key];
                    const inputs = document.querySelectorAll('.digit-input');
                    
                    // Encontrar el siguiente input vac√≠o si no hay uno enfocado
                    if (!focusedDigitInput) {
                        for (let i = 0; i < inputs.length; i++) {
                            if (inputs[i].value === '') {
                                currentDigitIndex = i;
                                break;
                            }
                        }
                    } else {
                        currentDigitIndex = parseInt(focusedDigitInput.dataset.digitIndex);
                    }
                    
                    // Rellenar los pr√≥ximos 3 d√≠gitos disponibles
                    for (let i = 0; i < 3 && currentDigitIndex + i < totalDigits; i++) {
                        const targetInput = document.querySelector(`[data-digit-index="${currentDigitIndex + i}"]`);
                        if (targetInput) {
                            targetInput.value = binaryValue[i];
                        }
                    }
                    
                    currentDigitIndex += 3;
                    
                    // Auto-avance de cursor: ir al siguiente input vac√≠o
                    let nextEmptyIndex = currentDigitIndex;
                    while (nextEmptyIndex < totalDigits) {
                        const targetInput = document.querySelector(`[data-digit-index="${nextEmptyIndex}"]`);
                        if (targetInput && targetInput.value === '') {
                            break;
                        }
                        nextEmptyIndex++;
                    }
                    
                    if (nextEmptyIndex < totalDigits) {
                        const targetInput = document.querySelector(`[data-digit-index="${nextEmptyIndex}"]`);
                        if (targetInput) {
                            targetInput.focus();
                            currentDigitIndex = nextEmptyIndex;
                        }
                    } else if (currentDigitIndex < totalDigits) {
                        const targetInput = document.querySelector(`[data-digit-index="${currentDigitIndex}"]`);
                        if (targetInput) {
                            targetInput.focus();
                        }
                    }
                    
                    // Sincronizar con input continuo
                    syncContinuousInput();
                    return;
                }
                
                // Si un input de d√≠gito tiene foco, permitir edici√≥n directa
                if (focusedDigitInput) {
                    // Para n√∫meros, permitir que el input maneje su propia edici√≥n y avanzar autom√°ticamente
                    if (/^\d$/.test(e.key)) {
                        // Reemplazar el contenido anterior con el nuevo d√≠gito
                        focusedDigitInput.value = e.key;
                        setTimeout(() => {
                            const nextInput = focusedDigitInput.parentElement.parentElement.querySelector(`[data-digit-index="${parseInt(focusedDigitInput.dataset.digitIndex) + 1}"]`);
                            if (nextInput) {
                                nextInput.focus();
                            }
                        }, 50);
                        return;
                    }
                    
                    // Para flechas, permitir navegaci√≥n entre inputs
                    if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        const nextInput = document.querySelector(`[data-digit-index="${parseInt(focusedDigitInput.dataset.digitIndex) + 1}"]`);
                        if (nextInput) {
                            nextInput.focus();
                        }
                        return;
                    }
                    if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        const prevInput = document.querySelector(`[data-digit-index="${parseInt(focusedDigitInput.dataset.digitIndex) - 1}"]`);
                        if (prevInput) {
                            prevInput.focus();
                        }
                        return;
                    }
                    
                    return;
                }
                
                // Solo procesar n√∫meros si ning√∫n input de d√≠gito tiene foco (escritura continua)
                if (/^\d$/.test(e.key)) {
                    e.preventDefault();
                    
                    if (currentDigitIndex < totalDigits) {
                        const targetInput = document.querySelector(`[data-digit-index="${currentDigitIndex}"]`);
                        if (targetInput) {
                            // Reemplazar el contenido anterior con el nuevo d√≠gito
                            targetInput.value = e.key;
                            currentDigitIndex++;
                            
                            // Sincronizar con input continuo
                            syncContinuousInput();
                        }
                    }
                }
                
                // Manejar Backspace solo si ning√∫n input tiene foco
                if (e.key === 'Backspace') {
                    e.preventDefault();
                    if (currentDigitIndex > 0) {
                        currentDigitIndex--;
                        const targetInput = document.querySelector(`[data-digit-index="${currentDigitIndex}"]`);
                        if (targetInput) {
                            targetInput.value = '';
                            targetInput.focus();
                            syncContinuousInput();
                        }
                    }
                }
            }
            
            // Limpiar event listeners anteriores si existen
            if (window.currentKeyCaptureHandler) {
                document.removeEventListener('keydown', window.currentKeyCaptureHandler);
            }
            
            // Guardar referencia al handler actual
            window.currentKeyCaptureHandler = handleKeyPress;
            
            // Agregar event listener global
            document.addEventListener('keydown', handleKeyPress);
            
            // Retornar funci√≥n para limpiar
            return () => {
                if (window.currentKeyCaptureHandler) {
                    document.removeEventListener('keydown', window.currentKeyCaptureHandler);
                    window.currentKeyCaptureHandler = null;
                }
            };
        }

        // Sincronizar input continuo con cuadr√≠cula de d√≠gitos
        function syncContinuousInput() {
            const continuousInput = document.getElementById('continuous-input');
            
            if (continuousInput) {
                // Recolectar todos los valores de todos los grupos
                let allValues = '';
                
                for (let groupIndex = 0; groupIndex < numberSequence.length; groupIndex++) {
                    // Buscar los inputs correspondientes a este grupo
                    const inputs = document.querySelectorAll(`[data-group-index="${groupIndex}"]`);
                    if (inputs.length === 6) {
                        allValues += inputs.map(input => input.value).join('');
                    }
                }
                
                continuousInput.value = allValues;
            }
        }



        // Sincronizar cuadr√≠cula de d√≠gitos con input continuo
        function syncDigitsGrid() {
            const continuousInput = document.getElementById('continuous-input');
            
            if (continuousInput) {
                const value = continuousInput.value.replace(/[^01]/g, ''); // Solo 0 y 1
                const digits = value.split('');
                
                // Distribuir los d√≠gitos en todos los grupos
                let digitIndex = 0;
                
                for (let groupIndex = 0; groupIndex < numberSequence.length; groupIndex++) {
                    // Buscar los inputs correspondientes a este grupo
                    const inputs = document.querySelectorAll(`[data-group-index="${groupIndex}"]`);
                    if (inputs.length === 6) {
                        for (let i = 0; i < 6; i++) {
                            inputs[i].value = digits[digitIndex + i] || '';
                        }
                        digitIndex += 6;
                    }
                }
            }
        }

        // Timer para fase de recall
        function startRecallTimer() {
            let recallTimeLeft = recallTime;
            document.getElementById('recall-timer-display').textContent = `Tiempo restante: ${recallTimeLeft.toFixed(1)} segundos`;
            
            recallTimerInterval = setInterval(() => {
                recallTimeLeft--;
                document.getElementById('recall-timer-display').textContent = `Tiempo restante: ${recallTimeLeft.toFixed(1)} segundos`;
                
                if (recallTimeLeft <= 0) {
                    clearInterval(recallTimerInterval);
                    checkAnswer();
                }
            }, 1000);
        }



        // Mostrar n√∫meros de nuevo
        function showNumberAgain() {
            if (currentMode === 'auto-advance') return; // No permitir en modo autoavance
            
            document.getElementById('input-phase').classList.add('hidden');
            document.getElementById('memorization-phase').classList.remove('hidden');
            currentNumberIndex = 0;
            updateDisplay();
            timer = memorizationTime;
            document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
            
            // Actualizar mensaje de memorizaci√≥n
            const memorizationInfo = document.getElementById('memorization-info');
            memorizationInfo.textContent = `Memoriza estos n√∫meros. Tienes ${memorizationTime.toFixed(1)} segundos.`;
            
            // Configurar captura global de teclas para memorizaci√≥n
            window.cleanupKeyCapture = setupGlobalKeyCapture();
            
            startTimer();
        }

                 // Verificar respuesta
         function checkAnswer() {
             // Limpiar captura global de teclas
             if (window.cleanupKeyCapture) {
                 window.cleanupKeyCapture();
                 window.cleanupKeyCapture = null;
             }
             
             // Recolectar todos los d√≠gitos de todos los grupos
             let userGroups = [];
             
             if (specialMatrixMode) {
                 // Modo especial: Matrices de 3x6 (18 d√≠gitos cada una)
                 // Recolectar de los inputs de cada matriz
                 for (let matrixIndex = 0; matrixIndex < numberSequence.length; matrixIndex++) {
                     const inputs = document.querySelectorAll(`[data-group-index="${matrixIndex}"]`);
                     if (inputs.length === 18) {
                         const matrixDigits = [];
                         for (let i = 0; i < 18; i++) {
                             matrixDigits.push(inputs[i].value || ' ');
                         }
                         
                         // Organizar en 3 filas de 6 d√≠gitos
                         const row1 = matrixDigits.slice(0, 6).join('');
                         const row2 = matrixDigits.slice(6, 12).join('');
                         const row3 = matrixDigits.slice(12, 18).join('');
                         const matrix = row1 + '\n' + row2 + '\n' + row3;
                         userGroups.push(matrix);
                     } else {
                         // Si no hay suficientes d√≠gitos, rellenar con espacios
                         userGroups.push('      \n      \n      ');
                     }
                 }
             } else {
                 // Modo normal: Grupos de 6 d√≠gitos (3+3)
                 // Para simplificar, vamos a usar el input continuo que ya tiene todos los valores
                 const continuousInput = document.getElementById('continuous-input');
                 if (continuousInput && continuousInput.value) {
                     const allDigits = continuousInput.value.replace(/[^01]/g, '');
                     
                     // Distribuir los d√≠gitos en grupos de 6 (3+3)
                     for (let i = 0; i < numberSequence.length; i++) {
                         const startIndex = i * 6;
                         const groupDigits = allDigits.substring(startIndex, startIndex + 6);
                         
                         if (groupDigits.length === 6) {
                             const firstPart = groupDigits.substring(0, 3);
                             const secondPart = groupDigits.substring(3, 6);
                             const group = firstPart + '\n' + secondPart;
                             userGroups.push(group);
                         } else {
                             // Si no hay suficientes d√≠gitos, rellenar con espacios
                             const firstPart = groupDigits.substring(0, 3).padEnd(3, ' ');
                             const secondPart = groupDigits.substring(3, 6).padEnd(3, ' ');
                             const group = firstPart + '\n' + secondPart;
                             userGroups.push(group);
                         }
                     }
                 } else {
                     // Fallback: recolectar de los inputs visibles
                     for (let groupIndex = 0; groupIndex < numberSequence.length; groupIndex++) {
                         const inputs = document.querySelectorAll(`[data-group-index="${groupIndex}"]`);
                         if (inputs.length === 6) {
                             const groupDigits = [];
                             for (let i = 0; i < 6; i++) {
                                 groupDigits.push(inputs[i].value || ' ');
                             }
                             
                             const firstPart = groupDigits.slice(0, 3).join('');
                             const secondPart = groupDigits.slice(3, 6).join('');
                             const group = firstPart + '\n' + secondPart;
                             userGroups.push(group);
                         } else {
                             userGroups.push('   \n   ');
                         }
                     }
                 }
             }
             
             // Comparar con la secuencia original
             const correct = userGroups.length === numberSequence.length && 
                            userGroups.every((group, index) => group === numberSequence[index]);
             
             isCorrect = correct;
             
             // Calcular precisi√≥n por d√≠gitos correctos de la ronda actual
             let correctDigits = 0;
             let totalDigits = 0;
             
             // Comparar cada d√≠gito individualmente
             for (let i = 0; i < numberSequence.length; i++) {
                 const expected = numberSequence[i];
                 const actual = userGroups[i] || '';
                 
                 // Separar en partes para comparar
                 const expectedParts = expected.split('\n');
                 const actualParts = actual.split('\n');
                 
                 // Comparar cada d√≠gito de cada parte (6 d√≠gitos total por grupo)
                 for (let partIndex = 0; partIndex < 2; partIndex++) {
                     const expectedPart = expectedParts[partIndex] || '';
                     const actualPart = actualParts[partIndex] || '';
                     
                     for (let j = 0; j < 3; j++) {
                         totalDigits++;
                         if (expectedPart[j] === actualPart[j]) {
                             correctDigits++;
                         }
                     }
                 }
             }
             
             // Calcular precisi√≥n de la ronda actual (porcentaje de d√≠gitos correctos)
             const roundAccuracy = totalDigits > 0 ? Math.round((correctDigits / totalDigits) * 100) : 0;
             
             // Debug: mostrar informaci√≥n del c√°lculo
             console.log('C√°lculo de precisi√≥n:');
             console.log('Grupos esperados:', numberSequence);
             console.log('Grupos del usuario:', userGroups);
             console.log('D√≠gitos correctos:', correctDigits);
             console.log('Total de d√≠gitos:', totalDigits);
             console.log('Porcentaje de acierto:', roundAccuracy + '%');
             
             // Guardar puntuaci√≥n de la ronda (1 si todos los n√∫meros son correctos, 0 si no)
             const roundScore = correct ? 1 : 0;
             roundScores.push(roundScore);
             totalScore += roundScore;
             
             // Guardar tambi√©n la precisi√≥n de d√≠gitos para esta ronda
             if (!window.roundAccuracies) window.roundAccuracies = [];
             window.roundAccuracies.push(roundAccuracy);
             
             // Calcular resultados detallados y marcar inputs
             results = userGroups.map((group, index) => {
                 const isGroupCorrect = group === numberSequence[index];
                 
                 // Marcar los inputs correspondientes
                 const inputs = document.querySelectorAll(`[data-group-index="${index}"]`);
                 if (inputs.length === 6) {
                     for (let i = 0; i < 6; i++) {
                         inputs[i].classList.remove('correct', 'incorrect');
                         inputs[i].classList.add(isGroupCorrect ? 'correct' : 'incorrect');
                     }
                 }
                 
                 return {
                     expected: numberSequence[index],
                     actual: group,
                     correct: isGroupCorrect
                 };
             });
             
             // Detener timers
             if (timerInterval) clearInterval(timerInterval);
             if (recallTimerInterval) clearInterval(recallTimerInterval);
             
             document.getElementById('input-phase').classList.add('hidden');
             
             // Actualizar informaci√≥n de la ronda
             document.getElementById('current-round-display').textContent = currentRound;
             document.getElementById('round-number').textContent = currentRound;
             document.getElementById('total-rounds').textContent = totalRounds;
             
             // Actualizar barra de progreso
             const progressPercentage = (currentRound / totalRounds) * 100;
             document.getElementById('round-progress-fill').style.width = progressPercentage + '%';
             
             // Mostrar botones seg√∫n si es la √∫ltima ronda
             if (currentRound === totalRounds) {
                 document.getElementById('next-round-btn').style.display = 'none';
                 document.getElementById('new-game-btn').style.display = 'none';
                 document.getElementById('menu-btn').style.display = 'inline-block';
             } else {
                 document.getElementById('next-round-btn').style.display = 'inline-block';
                 document.getElementById('new-game-btn').style.display = 'inline-block';
                 document.getElementById('menu-btn').style.display = 'none';
             }
             
             document.getElementById('result-phase').classList.remove('hidden');
             
             const resultMessage = document.getElementById('result-message');
             
             if (correct) {
                 resultMessage.className = 'result-message correct-result';
                 resultMessage.innerHTML = '¬°Correcto! üéâ';
             } else {
                 resultMessage.className = 'result-message incorrect-result';
                 resultMessage.innerHTML = 'Incorrecto ‚ùå';
             }
             
             // A√±adir el tiempo real de memorizaci√≥n:
             resultMessage.innerHTML += `<br><span style='font-size:1.1rem;color:#1976d2;'>Tiempo de memorizaci√≥n: <b>${actualMemorizationTime}</b> segundos</span>`;
             
             // Crear comparaci√≥n visual detallada
             createVisualComparison();
             
             // Mostrar resultado individual de la ronda
             updateRoundResult(roundAccuracy);
             
             // Mostrar progresi√≥n de resultados
             updateProgressDisplay();
             
             // Configurar event listeners para la configuraci√≥n de resultados
             setupResultConfiguration();
             
             // 3. En checkAnswer, guarda el tiempo real de memorizaci√≥n en un array global por ronda:
             if (!window.roundMemTimes) window.roundMemTimes = [];
             window.roundMemTimes.push(actualMemorizationTime);
         }

                 // Funci√≥n para pasar a la siguiente ronda
         function nextRound() {
             currentRound++;
             
             if (currentRound > totalRounds) {
                 // Mostrar resultados finales
                 showFinalResults();
             } else {
                 // Iniciar nueva ronda
                 startNewRound();
             }
         }
         
         // Funci√≥n para ir al men√∫ principal
         function goToMenu() {
             resetGame();
         }
         
         // Funci√≥n para iniciar una nueva ronda
         function startNewRound() {
             gameState = 'memorization';
             currentNumberIndex = 0;
             
             // Generar nueva secuencia para la ronda
             generateNumberSequence();
             
             // Usar tiempo seg√∫n el modo seleccionado
             if (currentMode === 'auto-advance') {
                 timer = autoAdvanceTime;
             } else {
                 timer = memorizationTime;
             }
             
             // Limpiar todos los campos antes de iniciar nueva ronda
             clearAllInputs();
             
             // Mostrar fase de preparaci√≥n antes de cada nueva ronda
             const prepEl = document.getElementById('preparation-phase');
             const prepCountdownEl = document.getElementById('prep-countdown');
             if (prepEl && prepCountdownEl) {
                 document.getElementById('result-phase').classList.add('hidden');
                 prepEl.classList.remove('hidden');
                 let prepTime = 5;
                 prepCountdownEl.textContent = `${prepTime}`;
                 if (window.prepInterval) clearInterval(window.prepInterval);
                 window.prepInterval = setInterval(() => {
                     prepTime--;
                     prepCountdownEl.textContent = `${prepTime}`;
                     if (prepTime <= 0) {
                         clearInterval(window.prepInterval);
                         prepEl.classList.add('hidden');
                         document.getElementById('memorization-phase').classList.remove('hidden');
                         updateDisplay();
                         
                         // Actualizar timer inicial
                         document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                         
                         // Actualizar mensaje de memorizaci√≥n
                         const memorizationInfo = document.getElementById('memorization-info');
                         if (currentMode === 'auto-advance') {
                             let totalPages;
                             if (displayMode === 'single') {
                                 totalPages = numberSequence.length;
                             } else if (displayMode === 'pairs') {
                                 totalPages = Math.ceil(numberSequence.length / 2);
                             } else if (displayMode === 'triple') {
                                 totalPages = Math.ceil(numberSequence.length / 3);
                             }
                             memorizationInfo.textContent = `Ronda ${currentRound} - P√°gina 1 de ${totalPages}. Avanzar√° autom√°ticamente en ${autoAdvanceTime.toFixed(1)} segundos.`;
                         } else {
                             memorizationInfo.textContent = `Ronda ${currentRound} - Memoriza estos n√∫meros binarios. Tienes ${memorizationTime.toFixed(1)} segundos.`;
                         }
                         
                         // Configurar captura global de teclas para memorizaci√≥n
                         window.cleanupKeyCapture = setupGlobalKeyCapture();
                         
                         memorizationStartTime = Date.now();
                         startTimer();
                     }
                 }, 1000);
             } else {
                 document.getElementById('result-phase').classList.add('hidden');
                 document.getElementById('memorization-phase').classList.remove('hidden');
                 updateDisplay();
                 document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                 memorizationStartTime = Date.now();
                 startTimer();
             }
         }
         
         // Funci√≥n para mostrar resultados finales
         function showFinalResults() {
             document.getElementById('result-phase').classList.add('hidden');
             document.getElementById('final-results-phase').classList.remove('hidden');
             
             // Calcular estad√≠sticas finales
             const correctRounds = roundScores.filter(score => score === 1).length;
             const incorrectRounds = totalRounds - correctRounds;
             const percentage = Math.round((totalScore / totalRounds) * 100);
             
             // Calcular precisi√≥n final como promedio de las precisiones de cada ronda
             let finalAccuracy = 0;
             if (window.roundAccuracies && window.roundAccuracies.length > 0) {
                 const totalAccuracySum = window.roundAccuracies.reduce((sum, acc) => sum + acc, 0);
                 finalAccuracy = Math.round(totalAccuracySum / window.roundAccuracies.length);
             }
             
             const bestStreak = calculateBestStreak();
             
             // Actualizar gr√°ficas circulares finales
             const finalAccuracyChart = document.getElementById('final-accuracy-chart');
             const finalScoreChart = document.getElementById('final-score-chart');
             const finalStreakChart = document.getElementById('final-streak-chart');
             
             if (finalAccuracyChart) {
                 const accuracyDegrees = (finalAccuracy / 100) * 360;
                 const accuracyColor = finalAccuracy >= 80 ? '#28a745' : finalAccuracy >= 50 ? '#ffc107' : '#dc3545';
                 finalAccuracyChart.style.background = `conic-gradient(${accuracyColor} 0deg ${accuracyDegrees}deg, #e9ecef ${accuracyDegrees}deg 360deg)`;
                 finalAccuracyChart.querySelector('.pie-chart-text').textContent = finalAccuracy + '%';
             }
             
             if (finalScoreChart) {
                 // Al finalizar, el progreso debe ser 100%
                 const scoreDegrees = 360; // 100% completo
                 finalScoreChart.style.background = `conic-gradient(#007bff 0deg ${scoreDegrees}deg, #e9ecef ${scoreDegrees}deg 360deg)`;
                 finalScoreChart.querySelector('.pie-chart-text').textContent = `${totalRounds}/${totalRounds}`;
             }
             
             if (finalStreakChart) {
                 const streakPercentage = Math.min((bestStreak / totalRounds) * 100, 100);
                 const streakDegrees = (streakPercentage / 100) * 360;
                 finalStreakChart.style.background = `conic-gradient(#ffc107 0deg ${streakDegrees}deg, #e9ecef ${streakDegrees}deg 360deg)`;
                 finalStreakChart.querySelector('.pie-chart-text').textContent = bestStreak;
             }
             
             // Actualizar estad√≠sticas detalladas
             const finalTotalScore = document.getElementById('final-total-score');
             const finalScorePercentage = document.getElementById('final-score-percentage');
             const finalCorrectRounds = document.getElementById('final-correct-rounds');
             const finalBestStreak = document.getElementById('final-best-streak');
             const finalTotalRounds = document.getElementById('final-total-rounds');
             const finalTotalRounds2 = document.getElementById('final-total-rounds-2');
             
             if (finalTotalScore) {
                 finalTotalScore.textContent = totalScore;
                 finalTotalScore.className = `stat-number ${percentage >= 80 ? 'correct' : percentage >= 50 ? 'neutral' : 'incorrect'}`;
             }
             if (finalScorePercentage) {
                 finalScorePercentage.textContent = finalAccuracy + '%';
                 finalScorePercentage.className = `stat-number ${finalAccuracy >= 80 ? 'correct' : finalAccuracy >= 50 ? 'neutral' : 'incorrect'}`;
             }
             if (finalCorrectRounds) {
                 finalCorrectRounds.textContent = correctRounds;
                 finalCorrectRounds.className = `stat-number correct`;
             }
             if (finalBestStreak) {
                 finalBestStreak.textContent = bestStreak;
                 finalBestStreak.className = `stat-number ${bestStreak >= 3 ? 'correct' : bestStreak >= 1 ? 'neutral' : 'incorrect'}`;
             }
             if (finalTotalRounds) finalTotalRounds.textContent = totalRounds;
             if (finalTotalRounds2) finalTotalRounds2.textContent = totalRounds;
             
             // Generar desglose visual de rondas
             const finalRoundsBreakdown = document.getElementById('final-rounds-breakdown');
             if (finalRoundsBreakdown) {
                 finalRoundsBreakdown.innerHTML = '';
                 
                 roundScores.forEach((score, index) => {
                     const roundItem = document.createElement('div');
                     roundItem.className = `round-item ${score === 1 ? 'correct' : 'incorrect'}`;
                     roundItem.textContent = `R${index + 1}`;
                     roundItem.title = `Ronda ${index + 1}: ${score === 1 ? 'Correcto' : 'Incorrecto'}`;
                     finalRoundsBreakdown.appendChild(roundItem);
                 });
             }
             
             // Generar an√°lisis de rendimiento
             const finalPerformanceStats = document.getElementById('final-performance-stats');
             if (finalPerformanceStats) {
                 const performanceClass = percentage >= 80 ? 'correct' : percentage >= 50 ? 'neutral' : 'incorrect';
                 
                 finalPerformanceStats.innerHTML = `
                     <div class="stat-card">
                         <div class="stat-label">Precisi√≥n por D√≠gitos</div>
                         <div class="stat-number ${performanceClass}">${finalAccuracy}%</div>
                         <div style="font-size: 0.9rem; color: #666;">
                             ${finalAccuracy >= 80 ? '¬°Excelente!' : finalAccuracy >= 50 ? 'Bueno' : 'Necesita mejorar'}
                         </div>
                     </div>
                     <div class="stat-card">
                         <div class="stat-label">Rondas Perfectas</div>
                         <div class="stat-number ${percentage >= 80 ? 'correct' : percentage >= 50 ? 'neutral' : 'incorrect'}">${percentage}%</div>
                         <div style="font-size: 0.9rem; color: #666;">
                             Rondas completamente correctas
                         </div>
                     </div>
                     <p><strong>Rondas correctas:</strong> ${correctRounds} de ${totalRounds}</p>
                     <p><strong>Rondas incorrectas:</strong> ${incorrectRounds} de ${totalRounds}</p>
                     <p><strong>Mejor racha:</strong> ${bestStreak} rondas consecutivas</p>
                     <p><strong>Precisi√≥n por d√≠gitos:</strong> ${finalAccuracy}%</p>
                     <p><strong>Rondas perfectas:</strong> ${percentage}%</p>
                 `;
             }
         }
         
         // Funci√≥n para calcular la mejor racha
         function calculateBestStreak() {
             let currentStreak = 0;
             let bestStreak = 0;
             
             roundScores.forEach(score => {
                 if (score === 1) {
                     currentStreak++;
                     bestStreak = Math.max(bestStreak, currentStreak);
                 } else {
                     currentStreak = 0;
                 }
             });
             
             return bestStreak;
         }
         
         // Funci√≥n para actualizar la visualizaci√≥n de progreso
         function updateProgressDisplay() {
             const percentageList = document.getElementById('rounds-percentage-list');
             const currentScoreEl = document.getElementById('current-score');
             const currentRoundEl = document.getElementById('current-round');
             const currentPercentageEl = document.getElementById('current-percentage');
             const currentStreakEl = document.getElementById('current-streak');
             
             if (!percentageList) return;
             
             // Limpiar contenedor
             percentageList.innerHTML = '';
             
             // Crear lista simple de porcentajes por ronda
             for (let i = 1; i <= totalRounds; i++) {
                 const roundDiv = document.createElement('div');
                 roundDiv.style.cssText = 'margin: 10px 0; padding: 10px; border-radius: 8px; font-weight: bold;';
                 
                 if (i <= window.roundAccuracies.length) {
                     // Ronda completada
                     const accuracy = window.roundAccuracies[i - 1];
                     const isCorrect = accuracy === 100;
                     roundDiv.style.backgroundColor = isCorrect ? '#d4edda' : '#f8d7da';
                     roundDiv.style.color = isCorrect ? '#155724' : '#721c24';
                     roundDiv.style.border = `2px solid ${isCorrect ? '#c3e6cb' : '#f5c6cb'}`;
                     roundDiv.innerHTML = `Ronda ${i}: ${accuracy}% ${isCorrect ? '(Correcto)' : '(Incorrecto)'}<br>`;
                     // Mostrar tiempo real de memorizaci√≥n si existe
                     if (window.roundMemTimes && window.roundMemTimes[i-1]) {
                         roundDiv.innerHTML += `<span style='font-size:1rem;color:#1976d2;'>üïí ${window.roundMemTimes[i-1]} segundos</span>`;
                     }
                 } else if (i === currentRound) {
                     // Ronda actual
                     roundDiv.style.backgroundColor = '#e9ecef';
                     roundDiv.style.color = '#6c757d';
                     roundDiv.style.border = '2px solid #dee2e6';
                     roundDiv.innerHTML = `Ronda ${i}: En progreso`;
                     // Mostrar tiempo real de memorizaci√≥n si existe para la ronda actual
                     if (window.roundMemTimes && window.roundMemTimes[i-1]) {
                         roundDiv.innerHTML += `<br><span style='font-size:1rem;color:#1976d2;'>üïí ${window.roundMemTimes[i-1]} segundos</span>`;
                     }
                 } else {
                     // Ronda futura
                                              roundDiv.style.backgroundColor = 'white';
                     roundDiv.style.color = '#6c757d';
                     roundDiv.style.border = '2px solid #dee2e6';
                     roundDiv.textContent = `Ronda ${i}: Pendiente`;
                 }
                 
                 percentageList.appendChild(roundDiv);
             }
             
             // Calcular estad√≠sticas
             const completedRounds = roundScores.length;
             
             // Calcular precisi√≥n total como promedio de las precisiones de cada ronda
             let totalAccuracy = 0;
             if (window.roundAccuracies && window.roundAccuracies.length > 0) {
                 const totalAccuracySum = window.roundAccuracies.reduce((sum, acc) => sum + acc, 0);
                 totalAccuracy = Math.round(totalAccuracySum / window.roundAccuracies.length);
             }
             
             const percentage = completedRounds > 0 ? Math.round((totalScore / completedRounds) * 100) : 0;
             const bestStreak = calculateBestStreak();
             
             // Actualizar elementos de estad√≠sticas
             if (currentScoreEl) {
                 currentScoreEl.textContent = totalScore;
                 currentScoreEl.className = `stat-number ${percentage >= 80 ? 'correct' : percentage >= 50 ? 'neutral' : 'incorrect'}`;
             }
             if (currentRoundEl) currentRoundEl.textContent = currentRound;
             if (currentPercentageEl) {
                 currentPercentageEl.textContent = totalAccuracy + '%';
                 currentPercentageEl.className = `stat-number ${totalAccuracy >= 80 ? 'correct' : totalAccuracy >= 50 ? 'neutral' : 'incorrect'}`;
             }
             if (currentStreakEl) {
                 currentStreakEl.textContent = bestStreak;
                 currentStreakEl.className = `stat-number ${bestStreak >= 3 ? 'correct' : bestStreak >= 1 ? 'neutral' : 'incorrect'}`;
             }
         }
         
         // Funci√≥n para mostrar el resultado individual de cada ronda
         function updateRoundResult(roundAccuracy) {
             const roundNumber = document.getElementById('current-round-number');
             const roundAccuracyEl = document.getElementById('round-accuracy');
             const roundStatus = document.getElementById('round-status');
             
             if (roundNumber) roundNumber.textContent = currentRound;
             
             // Actualizar porcentaje de acierto
             if (roundAccuracyEl) {
                 roundAccuracyEl.textContent = roundAccuracy + '%';
                 roundAccuracyEl.className = `stat-number ${roundAccuracy === 100 ? 'correct' : 'incorrect'}`;
             }
             
             // Actualizar estado (solo Correcto o Incorrecto)
             if (roundStatus) {
                 const statusText = roundAccuracy === 100 ? 'Correcto' : 'Incorrecto';
                 const statusClass = roundAccuracy === 100 ? 'correct' : 'incorrect';
                 
                 roundStatus.textContent = statusText;
                 roundStatus.className = `stat-number ${statusClass}`;
             }
         }
         
         // Funci√≥n para ir al men√∫ principal
         function goToMenu() {
             resetGame();
         }
         
         

        // Funci√≥n para limpiar completamente todos los campos
        function clearAllInputs() {
            // Limpiar todos los inputs de d√≠gitos
            const digitInputs = document.querySelectorAll('.digit-input');
            digitInputs.forEach(input => {
                input.value = '';
                input.classList.remove('correct', 'incorrect');
            });
            
            // Limpiar input continuo
            const continuousInput = document.getElementById('continuous-input');
            if (continuousInput) {
                continuousInput.value = '';
            }
            
            // Limpiar contenedor de comparaci√≥n visual
            const comparisonContainer = document.getElementById('visual-comparison-container');
            if (comparisonContainer) {
                comparisonContainer.innerHTML = '';
            }
            
            // Limpiar tambi√©n el contenedor de d√≠gitos
            const digitsContainer = document.getElementById('digits-input-container');
            if (digitsContainer) {
                digitsContainer.innerHTML = '';
            }
        }

        // Reiniciar juego
        function resetGame() {
            gameState = 'setup';
            userInput = '';
            isCorrect = null;
            timer = 0;
            autoAdvanceTimer = 0;
            currentNumberIndex = 0;
            numberSequence = [];
            results = [];
            
                         // Reiniciar variables de rondas
             currentRound = 1;
             roundScores = [];
             totalScore = 0;
             
             // Limpiar precisiones de rondas
             if (window.roundAccuracies) {
                 window.roundAccuracies = [];
             }
            
            // Limpiar captura global de teclas
            if (window.cleanupKeyCapture) {
                window.cleanupKeyCapture();
                window.cleanupKeyCapture = null;
            }
            
            // Limpiar todos los campos
            clearAllInputs();
            
                         // Limpiar progresi√≥n de resultados
             const progressContainer = document.getElementById('rounds-progress-display');
             if (progressContainer) {
                 progressContainer.innerHTML = '';
             }
             
             // Limpiar resultado de la ronda
             const roundAccuracy = document.getElementById('round-accuracy');
             
             if (roundAccuracy) {
                 roundAccuracy.textContent = '0%';
                 roundAccuracy.className = 'stat-number neutral';
             }
             
             // Limpiar lista de porcentajes
             const percentageList = document.getElementById('rounds-percentage-list');
             if (percentageList) {
                 percentageList.innerHTML = '';
             }
            
            document.getElementById('result-phase').classList.add('hidden');
            document.getElementById('final-results-phase').classList.add('hidden');
            document.getElementById('setup-phase').classList.remove('hidden');
            
            if (timerInterval) clearInterval(timerInterval);
            if (recallTimerInterval) clearInterval(recallTimerInterval);
        }

                 // Funci√≥n para configurar la configuraci√≥n en la fase de resultados
         function setupResultConfiguration() {
             // Establecer valores actuales en los campos de configuraci√≥n
             const resultMemorizationTimer = document.getElementById('result-memorization-timer');
             const resultAutoAdvanceTime = document.getElementById('result-auto-advance-time');
             const resultMemorizationMode = document.getElementById('result-memorization-mode');
             const resultAutoAdvanceMode = document.getElementById('result-auto-advance-mode');
             
             if (resultMemorizationTimer) {
                 resultMemorizationTimer.value = memorizationTime;
             }
             if (resultAutoAdvanceTime) {
                 resultAutoAdvanceTime.value = autoAdvanceTime;
             }
             
             // Configurar modo actual
             if (currentMode === 'memorization') {
                 if (resultMemorizationMode) resultMemorizationMode.checked = true;
                 if (resultAutoAdvanceMode) resultAutoAdvanceMode.checked = false;
             } else {
                 if (resultMemorizationMode) resultMemorizationMode.checked = false;
                 if (resultAutoAdvanceMode) resultAutoAdvanceMode.checked = true;
             }
             
                              // Event listeners para configuraci√≥n de resultados
                 if (resultMemorizationTimer) {
                     resultMemorizationTimer.addEventListener('input', function() {
                         if (this.value === '') {
                             memorizationTime = 0;
                             updateResultModeDescription();
                             return;
                         }
                         
                         memorizationTime = parseFloat(this.value) || 0;
                         updateResultModeDescription();
                         
                         // Mostrar conversi√≥n de tiempo
                         const conversionDiv = document.getElementById('result-memorization-time-conversion');
                         if (memorizationTime > 60) {
                             conversionDiv.textContent = `(${formatTimeDisplay(memorizationTime)})`;
                             conversionDiv.style.display = 'block';
                         } else {
                             conversionDiv.style.display = 'none';
                         }
                     });
                 }
             
                              if (resultAutoAdvanceTime) {
                     resultAutoAdvanceTime.addEventListener('input', function() {
                         if (this.value === '') {
                             autoAdvanceTime = 0;
                             updateResultModeDescription();
                             return;
                         }
                         
                         autoAdvanceTime = parseFloat(this.value) || 0;
                         updateResultModeDescription();
                     });
                 }
             
             if (resultMemorizationMode) {
                 resultMemorizationMode.addEventListener('change', function() {
                     if (this.checked) {
                         currentMode = 'memorization';
                         updateResultModeDescription();
                     }
                 });
             }
             
             if (resultAutoAdvanceMode) {
                 resultAutoAdvanceMode.addEventListener('change', function() {
                     if (this.checked) {
                         currentMode = 'auto-advance';
                         updateResultModeDescription();
                     }
                 });
             }
             
             // Actualizar descripci√≥n inicial
             updateResultModeDescription();
         }
         
         // Funci√≥n para actualizar descripci√≥n del modo en resultados
         function updateResultModeDescription() {
             const description = document.getElementById('result-mode-description');
             if (currentMode === 'memorization') {
                 description.textContent = `El juego usar√° el tiempo de memorizaci√≥n configurado (${memorizationTime.toFixed(1)} segundos).`;
             } else {
                 let pages = selectedDigits;
                 if (displayMode === 'pairs') {
                     pages = Math.ceil(selectedDigits / 2);
                 } else if (displayMode === 'triple') {
                     pages = Math.ceil(selectedDigits / 3);
                 }
                 const totalTime = pages * autoAdvanceTime;
                 description.textContent = `El juego avanzar√° autom√°ticamente cada ${autoAdvanceTime.toFixed(1)} segundos por p√°gina (${totalTime.toFixed(1)} segundos total).`;
             }
         }

                 // Funci√≥n para crear comparaci√≥n visual detallada
        function createVisualComparison() {
           const container = document.getElementById('visual-comparison-container');
           container.innerHTML = '';
           
           // Modo especial: Matriz 3x6
           if (specialMatrixMode) {
               container.style.cssText = 'display: flex; flex-direction: column; gap: 30px; max-width: 1000px; margin: 0 auto;';
               
               // Crear resultados para cada matriz
               for (let matrixIndex = 0; matrixIndex < results.length; matrixIndex++) {
                   const result = results[matrixIndex];
                   const correctMatrix = numberSequence[matrixIndex];
                   const userMatrix = result.actual;
                   
                   // Contenedor principal para la matriz
                   const matrixContainer = document.createElement('div');
                   matrixContainer.style.cssText = 'background: #f8f9fa; border: 2px solid #667eea; border-radius: 15px; padding: 20px;';
                   
                   // T√≠tulo de la matriz
                   const title = document.createElement('div');
                   title.textContent = `Matriz ${matrixIndex + 1}`;
                   title.style.cssText = 'text-align: center; font-weight: bold; font-size: 1.3rem; color: #667eea; margin-bottom: 20px;';
                   matrixContainer.appendChild(title);
                   
                   // Contenedor para mostrar "T√∫" vs "Correcta"
                   const comparisonContainer = document.createElement('div');
                   comparisonContainer.style.cssText = 'display: flex; gap: 30px; justify-content: center; align-items: flex-start;';
                   
                   // Separar las matrices en filas
                   const correctRows = correctMatrix.split('\n');
                   const userRows = userMatrix.split('\n');
                   
                   // ===== TU RESPUESTA =====
                   const userContainer = document.createElement('div');
                   userContainer.style.cssText = 'text-align: center;';
                   
                   const userLabel = document.createElement('div');
                   userLabel.textContent = 'T√∫';
                   userLabel.style.cssText = 'font-size: 1rem; color: #666; margin-bottom: 10px; font-weight: bold;';
                   userContainer.appendChild(userLabel);
                   
                   // Crear 3 filas de 6 d√≠gitos para la respuesta del usuario
                   for (let rowNum = 0; rowNum < 3; rowNum++) {
                       const row = document.createElement('div');
                       row.style.cssText = 'display: flex; gap: 5px; justify-content: center; margin-bottom: ' + (rowNum < 2 ? '10px' : '0');
                       
                       for (let colNum = 0; colNum < 6; colNum++) {
                           const digit = document.createElement('div');
                           const userDigit = userRows[rowNum] ? userRows[rowNum][colNum] : ' ';
                           const correctDigit = correctRows[rowNum] ? correctRows[rowNum][colNum] : ' ';
                           const isCorrect = userDigit === correctDigit;
                           
                           digit.style.cssText = 'width: 35px; height: 35px; font-size: 1.2rem; text-align: center; border: 2px solid; border-radius: 5px; font-family: Courier New, monospace; font-weight: bold; display: flex; align-items: center; justify-content: center;';
                           digit.textContent = userDigit || '_';
                           
                           // Aplicar colores seg√∫n si es correcto o incorrecto
                           if (isCorrect) {
                               digit.style.backgroundColor = '#d4edda';
                               digit.style.color = '#155724';
                               digit.style.borderColor = '#28a745';
                           } else {
                               digit.style.backgroundColor = '#f8d7da';
                               digit.style.color = '#721c24';
                               digit.style.borderColor = '#dc3545';
                           }
                           
                           row.appendChild(digit);
                       }
                       
                       userContainer.appendChild(row);
                   }
                   
                   // ===== RESPUESTA CORRECTA =====
                   const correctContainer = document.createElement('div');
                   correctContainer.style.cssText = 'text-align: center;';
                   
                   const correctLabel = document.createElement('div');
                   correctLabel.textContent = 'Correcta';
                   correctLabel.style.cssText = 'font-size: 1rem; color: #28a745; margin-bottom: 10px; font-weight: bold;';
                   correctContainer.appendChild(correctLabel);
                   
                   // Crear 3 filas de 6 d√≠gitos para la respuesta correcta
                   for (let rowNum = 0; rowNum < 3; rowNum++) {
                       const row = document.createElement('div');
                       row.style.cssText = 'display: flex; gap: 5px; justify-content: center; margin-bottom: ' + (rowNum < 2 ? '10px' : '0');
                       
                       for (let colNum = 0; colNum < 6; colNum++) {
                           const digit = document.createElement('div');
                           const correctDigit = correctRows[rowNum] ? correctRows[rowNum][colNum] : ' ';
                           
                           digit.style.cssText = 'width: 35px; height: 35px; font-size: 1.2rem; text-align: center; border: 2px solid #28a745; border-radius: 5px; font-family: Courier New, monospace; font-weight: bold; display: flex; align-items: center; justify-content: center; background: white; color: #155724;';
                           digit.textContent = correctDigit || '_';
                           
                           row.appendChild(digit);
                       }
                       
                       correctContainer.appendChild(row);
                   }
                   
                   comparisonContainer.appendChild(userContainer);
                   comparisonContainer.appendChild(correctContainer);
                   matrixContainer.appendChild(comparisonContainer);
                   container.appendChild(matrixContainer);
               }
               
               return;
           }
           
           if (direction === 'vertical') {
               // En modo vertical, usar la misma estructura que la fase de escritura
               // Calcular cu√°ntos grupos por p√°gina seg√∫n el modo de visualizaci√≥n
               let groupsPerPage = 1;
               if (displayMode === 'pairs') groupsPerPage = 2;
               else if (displayMode === 'triple') groupsPerPage = 3;
               
               // Calcular cu√°ntas p√°ginas de memorizaci√≥n hay
               const totalMemorizationPages = Math.ceil(results.length / groupsPerPage);
               
               // Crear contenedor principal con grid para las columnas
               const mainContainer = document.createElement('div');
               mainContainer.style.cssText = 'display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 5px; width: 100%; max-width: 700px; margin: 0 auto;';
               
               // Crear una columna para cada p√°gina de memorizaci√≥n
               for (let pageNum = 0; pageNum < totalMemorizationPages; pageNum++) {
                   const pageColumn = document.createElement('div');
                   pageColumn.style.cssText = 'display: flex; flex-direction: column; align-items: center; gap: 3px;';
                   
                   // Sin t√≠tulo de p√°gina para la fase de escritura
                   
                   // Calcular qu√© grupos pertenecen a esta p√°gina
                   const startGroupForPage = pageNum * groupsPerPage;
                   const endGroupForPage = Math.min(startGroupForPage + groupsPerPage, results.length);
                   
                   // Crear resultados para los grupos de esta p√°gina
                   for (let groupIndex = startGroupForPage; groupIndex < endGroupForPage; groupIndex++) {
                       const result = results[groupIndex];
                       const correctGroup = numberSequence[groupIndex];
                       const userGroup = result.actual;
                       
                       // Separar el grupo correcto en sus dos partes
                       const correctParts = correctGroup.split('\n');
                       const userParts = userGroup.split('\n');
                       
                       // Contenedor principal para TU RESPUESTA + RESPUESTA CORRECTA
                       const doubleGroupContainer = document.createElement('div');
                       doubleGroupContainer.style.cssText = 'display: flex; gap: 8px; align-items: center; margin-bottom: 8px;';
                       
                       // ===== TU RESPUESTA (CON COLORES) =====
                       const userGroupContainer = document.createElement('div');
                       userGroupContainer.style.cssText = 'text-align: center; padding: 6px; background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 4px; min-width: 90px; font-family: Courier New, monospace;';
                       
                       // T√≠tulo "Tu respuesta"
                       const userLabel = document.createElement('div');
                       userLabel.textContent = 'T√∫';
                       userLabel.style.cssText = 'font-size: 0.7rem; color: #666; margin-bottom: 3px; font-weight: bold;';
                       userGroupContainer.appendChild(userLabel);
                       
                       // Crear contenedor para la primera fila (3 d√≠gitos) - TU RESPUESTA
                       const userFirstRow = document.createElement('div');
                       userFirstRow.style.cssText = 'display: flex; gap: 3px; justify-content: center; margin-bottom: 3px;';
                       
                       // Crear contenedor para la segunda fila (3 d√≠gitos) - TU RESPUESTA
                       const userSecondRow = document.createElement('div');
                       userSecondRow.style.cssText = 'display: flex; gap: 3px; justify-content: center;';
                       
                       // Procesar primera fila (posiciones 0, 1, 2) - TU RESPUESTA
                       for (let digitIndex = 0; digitIndex < 3; digitIndex++) {
                           const digit = document.createElement('div');
                           const userDigit = userParts[0] ? userParts[0][digitIndex] : ' ';
                           const correctDigit = correctParts[0] ? correctParts[0][digitIndex] : ' ';
                           const isCorrect = userDigit === correctDigit;
                           
                           digit.style.cssText = 'width: 22px; height: 22px; font-size: 0.9rem; text-align: center; border: 1px solid #ddd; border-radius: 2px; font-family: Courier New, monospace; font-weight: bold; display: flex; align-items: center; justify-content: center;';
                           digit.textContent = userDigit || '_';
                           
                           // Aplicar colores seg√∫n si es correcto o incorrecto
                           if (isCorrect) {
                               digit.style.backgroundColor = '#d4edda';
                               digit.style.color = '#155724';
                               digit.style.borderColor = '#c3e6cb';
                           } else {
                               digit.style.backgroundColor = '#f8d7da';
                               digit.style.color = '#721c24';
                               digit.style.borderColor = '#f5c6cb';
                           }
                           
                           userFirstRow.appendChild(digit);
                       }
                       
                       // Procesar segunda fila (posiciones 3, 4, 5) - TU RESPUESTA
                       for (let digitIndex = 0; digitIndex < 3; digitIndex++) {
                           const digit = document.createElement('div');
                           const userDigit = userParts[1] ? userParts[1][digitIndex] : ' ';
                           const correctDigit = correctParts[1] ? correctParts[1][digitIndex] : ' ';
                           const isCorrect = userDigit === correctDigit;
                           
                           digit.style.cssText = 'width: 22px; height: 22px; font-size: 0.9rem; text-align: center; border: 1px solid #ddd; border-radius: 2px; font-family: Courier New, monospace; font-weight: bold; display: flex; align-items: center; justify-content: center;';
                           digit.textContent = userDigit || '_';
                           
                           // Aplicar colores seg√∫n si es correcto o incorrecto
                           if (isCorrect) {
                               digit.style.backgroundColor = '#d4edda';
                               digit.style.color = '#155724';
                               digit.style.borderColor = '#c3e6cb';
                           } else {
                               digit.style.backgroundColor = '#f8d7da';
                               digit.style.color = '#721c24';
                               digit.style.borderColor = '#f5c6cb';
                           }
                           
                           userSecondRow.appendChild(digit);
                       }
                       
                       userGroupContainer.appendChild(userFirstRow);
                       userGroupContainer.appendChild(userSecondRow);
                       
                       // ===== RESPUESTA CORRECTA =====
                       const correctGroupContainer = document.createElement('div');
                       correctGroupContainer.style.cssText = 'text-align: center; padding: 6px; background: #d4edda; border: 2px solid #28a745; border-radius: 4px; min-width: 90px; font-family: Courier New, monospace;';
                       
                       // T√≠tulo "Correcta"
                       const correctLabel = document.createElement('div');
                       correctLabel.textContent = 'Correcta';
                       correctLabel.style.cssText = 'font-size: 0.7rem; color: #155724; margin-bottom: 3px; font-weight: bold;';
                       correctGroupContainer.appendChild(correctLabel);
                       
                       // Crear contenedor para la primera fila (3 d√≠gitos) - CORRECTA
                       const correctFirstRow = document.createElement('div');
                       correctFirstRow.style.cssText = 'display: flex; gap: 3px; justify-content: center; margin-bottom: 3px;';
                       
                       // Crear contenedor para la segunda fila (3 d√≠gitos) - CORRECTA
                       const correctSecondRow = document.createElement('div');
                       correctSecondRow.style.cssText = 'display: flex; gap: 3px; justify-content: center;';
                       
                       // Procesar primera fila (posiciones 0, 1, 2) - CORRECTA
                       for (let digitIndex = 0; digitIndex < 3; digitIndex++) {
                           const digit = document.createElement('div');
                           const correctDigit = correctParts[0] ? correctParts[0][digitIndex] : ' ';
                           
                           digit.style.cssText = 'width: 22px; height: 22px; font-size: 0.9rem; text-align: center; border: 1px solid #28a745; border-radius: 2px; font-family: Courier New, monospace; font-weight: bold; display: flex; align-items: center; justify-content: center; background: white; color: #155724;';
                           digit.textContent = correctDigit || '_';
                           
                           correctFirstRow.appendChild(digit);
                       }
                       
                       // Procesar segunda fila (posiciones 3, 4, 5) - CORRECTA
                       for (let digitIndex = 0; digitIndex < 3; digitIndex++) {
                           const digit = document.createElement('div');
                           const correctDigit = correctParts[1] ? correctParts[1][digitIndex] : ' ';
                           
                           digit.style.cssText = 'width: 22px; height: 22px; font-size: 0.9rem; text-align: center; border: 1px solid #28a745; border-radius: 2px; font-family: Courier New, monospace; font-weight: bold; display: flex; align-items: center; justify-content: center; background: white; color: #155724;';
                           digit.textContent = correctDigit || '_';
                           
                           correctSecondRow.appendChild(digit);
                       }
                       
                       correctGroupContainer.appendChild(correctFirstRow);
                       correctGroupContainer.appendChild(correctSecondRow);
                       
                       // Agregar ambos contenedores al contenedor principal
                       doubleGroupContainer.appendChild(userGroupContainer);
                       doubleGroupContainer.appendChild(correctGroupContainer);
                       pageColumn.appendChild(doubleGroupContainer);
                   }
                   
                   mainContainer.appendChild(pageColumn);
               }
               
               container.appendChild(mainContainer);
           } else {
               // Modo horizontal - mostrar respuesta del usuario y respuesta correcta
               const groupsPerRow = 4;
               const totalGroups = results.length;
               const totalRows = Math.ceil(totalGroups / groupsPerRow);
               
               for (let rowIndex = 0; rowIndex < totalRows; rowIndex++) {
                   // Contenedor principal para esta fila
                   const mainRowContainer = document.createElement('div');
                   mainRowContainer.style.cssText = 'display: flex; flex-direction: column; gap: 15px; margin: 15px 0;';
                   
                   // Contenedor para las respuestas del usuario
                   const userRow = document.createElement('div');
                   userRow.className = 'comparison-row';
                   userRow.style.cssText = 'display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;';
                   
                   // T√≠tulo "Tus respuestas"
                   const userTitle = document.createElement('div');
                   userTitle.textContent = 'Tus respuestas:';
                   userTitle.style.cssText = 'font-size: 0.9rem; color: #666; font-weight: bold; text-align: center; width: 100%; margin-bottom: 5px;';
                   mainRowContainer.appendChild(userTitle);
                   
                   const startIndex = rowIndex * groupsPerRow;
                   const endIndex = Math.min(startIndex + groupsPerRow, totalGroups);
                   
                   for (let i = startIndex; i < endIndex; i++) {
                       const result = results[i];
                       const correctGroup = numberSequence[i];
                       const userGroup = result.actual;
                       
                       const correctParts = correctGroup.split('\n');
                       const userParts = userGroup.split('\n');
                       
                       const groupContainer = document.createElement('div');
                       groupContainer.style.display = 'flex';
                       groupContainer.style.flexDirection = 'column';
                       groupContainer.style.gap = '2px';
                       groupContainer.style.margin = '0 5px';
                       groupContainer.style.padding = '8px';
                       groupContainer.style.background = '#f8f9fa';
                       groupContainer.style.borderRadius = '4px';
                       groupContainer.style.border = '1px solid #e9ecef';
                       
                       for (let partIndex = 0; partIndex < 2; partIndex++) {
                           const correctPart = correctParts[partIndex] || '';
                           const userPart = userParts[partIndex] || '';
                           
                           const lineContainer = document.createElement('div');
                           lineContainer.style.display = 'flex';
                           lineContainer.style.gap = '2px';
                           
                           for (let digitIndex = 0; digitIndex < 3; digitIndex++) {
                               const digit = document.createElement('div');
                               const isCorrect = userPart[digitIndex] === correctPart[digitIndex];
                               digit.className = `comparison-digit ${isCorrect ? 'correct' : 'incorrect'}`;
                               digit.textContent = userPart[digitIndex] || '_';
                               digit.style.width = '25px';
                               digit.style.height = '30px';
                               digit.style.fontSize = '1rem';
                               
                               lineContainer.appendChild(digit);
                           }
                           
                           groupContainer.appendChild(lineContainer);
                       }
                       
                       userRow.appendChild(groupContainer);
                   }
                   
                   mainRowContainer.appendChild(userRow);
                   
                   // Contenedor para las respuestas correctas
                   const correctRow = document.createElement('div');
                   correctRow.className = 'comparison-row';
                   correctRow.style.cssText = 'display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;';
                   
                   // T√≠tulo "Respuestas correctas"
                   const correctTitle = document.createElement('div');
                   correctTitle.textContent = 'Respuestas correctas:';
                   correctTitle.style.cssText = 'font-size: 0.9rem; color: #155724; font-weight: bold; text-align: center; width: 100%; margin-bottom: 5px;';
                   mainRowContainer.appendChild(correctTitle);
                   
                   for (let i = startIndex; i < endIndex; i++) {
                       const correctGroup = numberSequence[i];
                       const correctParts = correctGroup.split('\n');
                       
                       const groupContainer = document.createElement('div');
                       groupContainer.style.display = 'flex';
                       groupContainer.style.flexDirection = 'column';
                       groupContainer.style.gap = '2px';
                       groupContainer.style.margin = '0 5px';
                       groupContainer.style.padding = '8px';
                       groupContainer.style.background = '#d4edda';
                       groupContainer.style.borderRadius = '4px';
                       groupContainer.style.border = '2px solid #28a745';
                       
                       for (let partIndex = 0; partIndex < 2; partIndex++) {
                           const correctPart = correctParts[partIndex] || '';
                           
                           const lineContainer = document.createElement('div');
                           lineContainer.style.display = 'flex';
                           lineContainer.style.gap = '2px';
                           
                           for (let digitIndex = 0; digitIndex < 3; digitIndex++) {
                               const digit = document.createElement('div');
                               digit.style.cssText = 'width: 25px; height: 30px; font-size: 1rem; text-align: center; border: 1px solid #28a745; border-radius: 3px; font-family: Courier New, monospace; font-weight: bold; display: flex; align-items: center; justify-content: center; background: white; color: #155724;';
                               digit.textContent = correctPart[digitIndex] || '_';
                               
                               lineContainer.appendChild(digit);
                           }
                           
                           groupContainer.appendChild(lineContainer);
                       }
                       
                       correctRow.appendChild(groupContainer);
                   }
                   
                   mainRowContainer.appendChild(correctRow);
                   container.appendChild(mainRowContainer);
               }
           }
       }

        // Funci√≥n para alternar pantalla completa
        function toggleFullscreen() {
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            
            if (!document.fullscreenElement) {
                // Entrar en pantalla completa
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.webkitRequestFullscreen) {
                    document.documentElement.webkitRequestFullscreen();
                } else if (document.documentElement.msRequestFullscreen) {
                    document.documentElement.msRequestFullscreen();
                }
                
                fullscreenBtn.textContent = '‚õ∂';
                fullscreenBtn.title = 'Salir Pantalla Completa';
                fullscreenBtn.classList.add('fullscreen');
            } else {
                // Salir de pantalla completa
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                
                fullscreenBtn.textContent = '‚õ∂';
                fullscreenBtn.title = 'Pantalla Completa';
                fullscreenBtn.classList.remove('fullscreen');
            }
        }
        
        // Event listener para detectar cambios en pantalla completa
        document.addEventListener('fullscreenchange', updateFullscreenButton);
        document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
        document.addEventListener('msfullscreenchange', updateFullscreenButton);
        
        // Funci√≥n para actualizar el bot√≥n seg√∫n el estado de pantalla completa
        function updateFullscreenButton() {
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            
            if (document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement) {
                fullscreenBtn.textContent = '‚õ∂';
                fullscreenBtn.title = 'Salir Pantalla Completa';
                fullscreenBtn.classList.add('fullscreen');
            } else {
                fullscreenBtn.textContent = '‚õ∂';
                fullscreenBtn.title = 'Pantalla Completa';
                fullscreenBtn.classList.remove('fullscreen');
            }
        }
        
        // Configurar input continuo y limpiar campos al cargar
        document.addEventListener('DOMContentLoaded', function() {
            const continuousInput = document.getElementById('continuous-input');
            if (continuousInput) {
                continuousInput.addEventListener('input', function() {
                    syncDigitsGrid();
                });
            }
            
            // Limpiar todos los campos al cargar la p√°gina
            clearAllInputs();
            
            // No establecer autom√°ticamente el valor por defecto para permitir que el usuario lo borre
            const digitsInput = document.getElementById('digits-input');
            if (digitsInput && (!digitsInput.value || digitsInput.value === '')) {
                // No establecer valor autom√°ticamente, solo actualizar la informaci√≥n
                selectedDigits = 5;
                const pages = Math.ceil(selectedDigits / (displayMode === 'single' ? 1 : displayMode === 'pairs' ? 2 : 3));
                document.getElementById('selected-info').textContent = `Memorizar√°s ${selectedDigits} grupos de n√∫meros binarios de 3 d√≠gitos (${pages} p√°ginas)`;
                updateSummary();
                updateModeDescription();
                updateDisplayInfo();
            }
            
            // No establecer autom√°ticamente valores por defecto para permitir que el usuario los borre
            const memorizationTimer = document.getElementById('memorization-timer');
            if (memorizationTimer && (!memorizationTimer.value || memorizationTimer.value === '')) {
                // No establecer valor autom√°ticamente, solo actualizar la informaci√≥n
                memorizationTime = 15;
                updateSummary();
                updateModeDescription();
            }
            
            const recallTimer = document.getElementById('recall-timer');
            if (recallTimer && (!recallTimer.value || recallTimer.value === '')) {
                // No establecer valor autom√°ticamente, solo actualizar la informaci√≥n
                recallTime = 30;
                updateSummary();
                updateModeDescription();
            }
            
            const autoAdvanceTimeEl2 = document.getElementById('auto-advance-time');
            if (autoAdvanceTimeEl2 && (!autoAdvanceTimeEl2.value || autoAdvanceTimeEl2.value === '')) {
                // No establecer valor autom√°ticamente, solo actualizar la informaci√≥n
                autoAdvanceTime = 3;
                updateSummary();
                updateModeDescription();
            }
            
            // Configurar valor por defecto para rondas
            const roundsInput = document.getElementById('rounds-input');
            if (roundsInput && (!roundsInput.value || roundsInput.value === '')) {
                // No establecer valor autom√°ticamente, solo actualizar la informaci√≥n
                totalRounds = 10;
                document.getElementById('rounds-info').textContent = `Jugar√°s ${totalRounds} rondas en total`;
                updateSummary();
            }
            
            // Asegurar que el modo de memorizaci√≥n est√© seleccionado por defecto
            const memorizationMode = document.getElementById('memorization-mode');
            if (memorizationMode) {
                memorizationMode.checked = true;
            }
            
            // Asegurar que la direcci√≥n horizontal est√© seleccionada por defecto
            const horizontalDirection = document.getElementById('horizontal-direction');
            if (horizontalDirection) {
                horizontalDirection.checked = true;
            }
            
            // Event listeners para establecer valores por defecto cuando los campos est√©n vac√≠os
            const memorizationTimerEl = document.getElementById('memorization-timer');
            if (memorizationTimerEl) {
                memorizationTimerEl.addEventListener('blur', function() {
                    if (!this.value || this.value === '') {
                        this.value = '15';
                        memorizationTime = 15;
                        updateSummary();
                        updateModeDescription();
                    }
                });
                
                // Permitir borrar completamente el campo
                memorizationTimerEl.addEventListener('input', function() {
                    if (this.value === '') {
                        memorizationTime = 0;
                        updateSummary();
                        updateModeDescription();
                        return;
                    }
                    
                    memorizationTime = parseFloat(this.value) || 0;
                    updateSummary();
                    updateModeDescription();
                    
                    // Mostrar conversi√≥n de tiempo
                    const conversionDiv = document.getElementById('memorization-time-conversion');
                    if (memorizationTime > 60) {
                        conversionDiv.textContent = `(${formatTimeDisplay(memorizationTime)})`;
                        conversionDiv.style.display = 'block';
                    } else {
                        conversionDiv.style.display = 'none';
                    }
                });
            }
            
            const recallTimerEl = document.getElementById('recall-timer');
            if (recallTimerEl) {
                recallTimerEl.addEventListener('blur', function() {
                    if (!this.value || this.value === '') {
                        this.value = '30';
                        recallTime = 30;
                        updateSummary();
                        updateModeDescription();
                    }
                });
                
                // Permitir borrar completamente el campo
                recallTimerEl.addEventListener('input', function() {
                    if (this.value === '') {
                        recallTime = 0;
                        updateSummary();
                        updateModeDescription();
                        return;
                    }
                    
                    recallTime = parseFloat(this.value) || 0;
                    updateSummary();
                    updateModeDescription();
                    
                    // Mostrar conversi√≥n de tiempo
                    const conversionDiv = document.getElementById('recall-time-conversion');
                    if (recallTime > 60) {
                        conversionDiv.textContent = `(${formatTimeDisplay(recallTime)})`;
                        conversionDiv.style.display = 'block';
                    } else {
                        conversionDiv.style.display = 'none';
                    }
                });
            }
            
            const autoAdvanceTimeEl = document.getElementById('auto-advance-time');
            if (autoAdvanceTimeEl) {
                autoAdvanceTimeEl.addEventListener('blur', function() {
                    if (!this.value || this.value === '') {
                        this.value = '3';
                        autoAdvanceTime = 3;
                        updateSummary();
                        updateModeDescription();
                    }
                });
                
                // Permitir borrar completamente el campo
                autoAdvanceTimeEl.addEventListener('input', function() {
                    if (this.value === '') {
                        autoAdvanceTime = 0;
                        updateSummary();
                        updateModeDescription();
                        return;
                    }
                    
                    autoAdvanceTime = parseFloat(this.value) || 0;
                    updateSummary();
                    updateModeDescription();
                });
            }
            
            // Actualizar resumen y descripci√≥n inicial
            updateSummary();
            updateModeDescription();
            

            
            // Funci√≥n para validar si se puede comenzar el juego
            function validateGameStart() {
                const digitsInput = document.getElementById('digits-input');
                const memorizationTimer = document.getElementById('memorization-timer');
                const recallTimer = document.getElementById('recall-timer');
                const autoAdvanceTimeInput = document.getElementById('auto-advance-time');
                const roundsInput = document.getElementById('rounds-input');
                const startButton = document.querySelector('button[onclick="startGame()"]');
                
                // Verificar si los campos tienen valores v√°lidos
                const hasDigits = selectedDigits > 0;
                const hasRounds = totalRounds > 0;
                const hasRecallTime = recallTime > 0;
                
                let hasTimeMode = false;
                if (currentMode === 'memorization') {
                    hasTimeMode = memorizationTime > 0;
                } else {
                    hasTimeMode = autoAdvanceTime > 0;
                }
                
                const canStart = hasDigits && hasRounds && hasRecallTime && hasTimeMode;
                
                if (startButton) {
                    startButton.disabled = !canStart;
                    if (canStart) {
                        startButton.style.opacity = '1';
                        startButton.style.cursor = 'pointer';
                    } else {
                        startButton.style.opacity = '0.6';
                        startButton.style.cursor = 'not-allowed';
                    }
                }
            }
            
            // Llamar a la validaci√≥n inicial
            validateGameStart();
            
            // A√±adir event listeners para validaci√≥n en tiempo real
            const digitsInputEl2 = document.getElementById('digits-input');
            const memorizationTimerEl2 = document.getElementById('memorization-timer');
            const recallTimerEl2 = document.getElementById('recall-timer');
            const autoAdvanceTimeInputEl2 = document.getElementById('auto-advance-time');
            const roundsInputEl2 = document.getElementById('rounds-input');
            
            if (digitsInputEl2) {
                digitsInputEl2.addEventListener('input', validateGameStart);
            }
            if (memorizationTimerEl2) {
                memorizationTimerEl2.addEventListener('input', validateGameStart);
            }
            if (recallTimerEl2) {
                recallTimerEl2.addEventListener('input', validateGameStart);
            }
            if (autoAdvanceTimeInputEl2) {
                autoAdvanceTimeInputEl2.addEventListener('input', validateGameStart);
            }
            if (roundsInputEl2) {
                roundsInputEl2.addEventListener('input', validateGameStart);
            }
            
            // Validar tambi√©n cuando cambie el modo
            const memorizationModeEl = document.getElementById('memorization-mode');
            const autoAdvanceModeEl = document.getElementById('auto-advance-mode');
            
            if (memorizationModeEl) {
                memorizationModeEl.addEventListener('change', validateGameStart);
            }
            if (autoAdvanceModeEl) {
                autoAdvanceModeEl.addEventListener('change', validateGameStart);
            }
        });
    </script>
</body>
</html> 